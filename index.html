<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>English Tenses Trainer</title>
  <style>
    :root{
      --bg:#0f172a;--text:#e5e7eb;--accent:#22d3ee;--accent2:#a78bfa;--good:#34d399;--bad:#f87171;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;display:flex;justify-content:center}
    .app{width:100%;max-width:820px;padding:16px 16px 80px}
    h1{font-size:24px;text-align:center;margin:20px 0}
    .card{background:rgba(255,255,255,.05);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:20px}
    button,input{appearance:none;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.08);color:var(--text);padding:14px 20px;border-radius:12px;font-weight:600;cursor:pointer}
    input{width:100%}
    .choice{display:block;width:100%;margin:6px 0}
    .choice.correct{border-color:var(--good);background:rgba(52,211,153,.14)}
    .choice.wrong{border-color:var(--bad);background:rgba(248,113,113,.14)}
    .progress{height:10px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden;margin:10px 0}
    .progress>div{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0}
    .hidden{display:none}
    .chips{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:10px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.1);font-size:14px;cursor:pointer}
    .chip.active{border-color:var(--accent);background:rgba(34,211,238,.25)}
    #explain{margin-top:10px;font-size:14px;color:#cbd5e1;text-align:center}
  </style>
</head>
<body>
  <div class="app">
    <section class="card" id="startScreen">
      <h1>English Tenses Trainer</h1>
      <p style="text-align:center">Wähle Modus und Zeitformen. Fokus auf <b>to use</b> in allen Zeiten + Signalwörtern (usually / used to / have used).</p>

      <h3>Modus auswählen</h3>
      <div class="chips" id="modeChips"></div>
      <p style="font-size:12px;text-align:center">Learn = mit Erklärungen · Practice = schneller · Test = Ergebnis am Schluss · Blind = ohne Hinweise · Write = selbst schreiben (streng, inkl. Rechtschreibung)</p>

      <h3>Zeitformen / Kategorien auswählen</h3>
      <div class="chips" id="tenseChips"></div>

      <div class="row">
        <button id="startBtn">Start Training</button>
      </div>
    </section>

    <section class="card hidden" id="quiz">
      <div class="progress"><div id="progBar"></div></div>
      <h2 id="qText"></h2>
      <div id="choices"></div>
      <div id="explain"></div>
      <div class="row"><button id="checkBtn" class="hidden">Prüfen</button><button id="nextBtn">Weiter</button></div>
    </section>

    <section class="card hidden" id="result">
      <h2>Dein Ergebnis</h2>
      <p id="finalScore">0/0</p>
      <div class="row"><button id="retryBtn">Nochmal</button><button id="homeBtn">Home</button></div>
    </section>
  </div>

  <script>
  // ——————————————————————————————————————————————
  // FRAGEN-POOL (to use + Signalwörter) — alle wichtigen Zeitformen
  // tenses-Tags steuern Filter-Chips auf dem Startscreen
  // ——————————————————————————————————————————————
  const BANK=[
    // SIGNALWÖRTER (usually / used to / have used)
    {q:"She ___ goes to school by bus.",choices:["usually","used to","have used"],a:0,tenses:["signals"],exp:"Gewohnheit jetzt → Present Simple Signalwort: usually."},
    {q:"I ___ live in London, but now I live in Bern.",choices:["used to","usually","have used"],a:0,tenses:["signals"],exp:"Frühere Gewohnheit/Zustand, gilt heute nicht mehr → used to."},
    {q:"I ___ this tool many times before.",choices:["have used","usually","used to"],a:0,tenses:["signals"],exp:"Present Perfect: have + past participle (used)."},

    // PRESENT SIMPLE
    {q:"He ___ the same password every day.",choices:["uses","use","is using"],a:0,tenses:["presentSimple"],exp:"He/She/It → -s: uses."},
    {q:"They ___ open-source libraries.",choices:["use","uses","are using"],a:0,tenses:["presentSimple"],exp:"Plural → base form: use."},

    // PRESENT CONTINUOUS
    {q:"Right now I ___ the printer.",choices:["am using","use","have used"],a:0,tenses:["presentCont"],exp:"Gerade jetzt → am/is/are + using."},
    {q:"She ___ the app at the moment.",choices:["is using","uses","has used"],a:0,tenses:["presentCont"],exp:"at the moment → Present Continuous: is using."},

    // PRESENT PERFECT SIMPLE
    {q:"We ___ this software already.",choices:["have used","had used","use"],a:0,tenses:["presentPerf"],exp:"Present Perfect: have/has + used (Bezug zur Gegenwart)."},
    {q:"He ___ this feature before.",choices:["has used","have used","was using"],a:0,tenses:["presentPerf"],exp:"He → has used."},

    // PRESENT PERFECT CONTINUOUS
    {q:"I ___ this file for an hour.",choices:["have been using","had been using","am using"],a:0,tenses:["presentPerfCont"],exp:"have/has been + -ing (Dauer bis jetzt)."},

    // PAST SIMPLE
    {q:"Yesterday I ___ the wrong command.",choices:["used","use","was using"],a:0,tenses:["pastSimple"],exp:"Abgeschlossen gestern → used."},

    // PAST CONTINUOUS
    {q:"At 7 pm we ___ the computers.",choices:["were using","used","are using"],a:0,tenses:["pastCont"],exp:"Zeitpunkt in der Vergangenheit im Verlauf → were using."},

    // PAST PERFECT
    {q:"Before the update, they ___ an older version.",choices:["had used","have used","used"],a:0,tenses:["pastPerf"],exp:"Vorvergangenheit → had used."},

    // PAST PERFECT CONTINUOUS
    {q:"He ___ the beta for weeks before release.",choices:["had been using","has been using","was using"],a:0,tenses:["pastPerfCont"],exp:"had been + -ing (Dauer vor einem Vergangenheitszeitpunkt)."},

    // WILL-FUTURE
    {q:"I think I ___ this method tomorrow.",choices:["will use","am going to use","use"],a:0,tenses:["futureWill"],exp:"spontane Entscheidung/Meinung → will + base."},

    // GOING-TO-FUTURE
    {q:"We ___ this template next week (plan).",choices:["are going to use","will use","use"],a:0,tenses:["futureGoingTo"],exp:"geplanter Vorsatz → be going to + base."},

    // FUTURE CONTINUOUS
    {q:"At 3 pm tomorrow she ___ the lab PCs.",choices:["will be using","will use","is using"],a:0,tenses:["futureCont"],exp:"Vorgang zu einem Zeitpunkt in der Zukunft → will be using."},

    // FUTURE PERFECT
    {q:"By Friday, we ___ the new version.",choices:["will have used","will use","are using"],a:0,tenses:["futurePerf"],exp:"bis zu einem Zeitpunkt in der Zukunft abgeschlossen → will have used."},

    // FUTURE PERFECT CONTINUOUS
    {q:"By noon, I ___ this tool for 4 hours.",choices:["will have been using","will be using","will have used"],a:0,tenses:["futurePerfCont"],exp:"Dauer bis zu einem zukünftigen Zeitpunkt → will have been using."},

    // CONDITIONAL (würde)
    {q:"If I had more time, I ___ it.",choices:["would use","will use","am using"],a:0,tenses:["cond"],exp:"2nd Conditional → would + base."},

    // CONDITIONAL CONTINUOUS
    {q:"With faster Wi‑Fi, we ___ the cloud more often.",choices:["would be using","would use","will be using"],a:0,tenses:["condCont"],exp:"andauernde hypothetische Handlung → would be using."},

    // CONDITIONAL PERFECT
    {q:"With a license, she ___ the premium features.",choices:["would have used","had used","would use"],a:0,tenses:["condPerf"],exp:"3rd Conditional/irreale Vergangenheit → would have used."},

    // CONDITIONAL PERFECT CONTINUOUS
    {q:"If the servers hadn’t crashed, they ___ it all day.",choices:["would have been using","would be using","will have been using"],a:0,tenses:["condPerfCont"],exp:"dauerhafte irreale Vergangenheit → would have been using."},
  ];

  // Filter-Gruppen / Chips
  const TENSE_LABELS={
    signals:"Signalwörter (usually / used to / have used)",
    presentSimple:"Present Simple",
    presentCont:"Present Continuous",
    presentPerf:"Present Perfect",
    presentPerfCont:"Present Perfect Continuous",
    pastSimple:"Past Simple",
    pastCont:"Past Continuous",
    pastPerf:"Past Perfect",
    pastPerfCont:"Past Perfect Continuous",
    futureWill:"Future (will)",
    futureGoingTo:"Future (going to)",
    futureCont:"Future Continuous",
    futurePerf:"Future Perfect",
    futurePerfCont:"Future Perfect Continuous",
    cond:"Conditional",
    condCont:"Conditional Continuous",
    condPerf:"Conditional Perfect",
    condPerfCont:"Conditional Perfect Continuous"
  };

  const MODES=[
    {id:'learn',label:'Learn'},
    {id:'practice',label:'Practice'},
    {id:'test',label:'Test'},
    {id:'blind',label:'Blind'},
    {id:'write',label:'Write'}
  ];

  const $=s=>document.querySelector(s);const $$=s=>Array.from(document.querySelectorAll(s));
  const state={mode:'learn',selectedTenses:new Set(Object.keys(TENSE_LABELS)),pool:[],idx:0,score:0,locked:false,current:null,choiceOrder:[]};

  // Modus-Chips
  const modeChips=$('#modeChips');
  MODES.forEach(m=>{const chip=document.createElement('div');chip.className='chip'+(m.id===state.mode?' active':'');chip.textContent=m.label;chip.addEventListener('click',()=>{state.mode=m.id;$$('#modeChips .chip').forEach(c=>c.classList.remove('active'));chip.classList.add('active');});modeChips.appendChild(chip);});

  // Zeitform-Chips
  const tenseChips=$('#tenseChips');
  Object.entries(TENSE_LABELS).forEach(([key,label])=>{const chip=document.createElement('div');chip.className='chip active';chip.textContent=label;chip.addEventListener('click',()=>{if(state.selectedTenses.has(key)){state.selectedTenses.delete(key);chip.classList.remove('active');}else{state.selectedTenses.add(key);chip.classList.add('active');}});tenseChips.appendChild(chip);});

  // Helper
  function shuffle(a){return a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(v=>v[1]);}
  function buildPool(){let chosen=BANK.filter(q=>q.tenses.some(t=>state.selectedTenses.has(t)));state.pool=shuffle(chosen);state.idx=0;state.score=0;}

  function nextQuestion(){if(state.idx>=state.pool.length){return showResult();}
    const q=state.pool[state.idx]; state.current=q;
    $('#qText').textContent=q.q; const box=$('#choices'); box.innerHTML='';
    if(state.mode==='write'){
      const input=document.createElement('input'); input.type='text'; input.id='writeInput'; input.placeholder='Antwort hier eingeben (groß/klein zählt)'; box.appendChild(input);
      $('#checkBtn').classList.remove('hidden'); $('#nextBtn').classList.add('hidden');
    } else {
      // Shuffle choices per question and remember the display order
      const order=shuffle(q.choices.map((_,i)=>i));
      state.choiceOrder=order;
      order.forEach((origIdx,displayIdx)=>{
        const b=document.createElement('button');
        b.className='choice';
        b.textContent=q.choices[origIdx];
        b.addEventListener('click',()=>pick(displayIdx));
        box.appendChild(b);
      });
      $('#checkBtn').classList.add('hidden'); $('#nextBtn').classList.remove('hidden');
    }
    $('#progBar').style.width=(state.idx/state.pool.length*100)+"%"; $('#explain').textContent='';
  }

  function pick(i){ if(state.locked) return; state.locked=true; const q=state.current; const correct=(state.choiceOrder[i]===q.a);
    const buttons=$$('#choices .choice');
    buttons.forEach((b,j)=>{ if(state.choiceOrder[j]===q.a) b.classList.add('correct'); if(j===i && !correct) b.classList.add('wrong'); b.disabled=true; });
    if(correct) state.score++;
    if(state.mode==='learn' || (!correct && state.mode!=='blind')){ $('#explain').textContent=q.exp; }
  }

  function pickWrite(){ if(state.locked) return; state.locked=true; const q=state.current; const val=$('#writeInput').value.trim(); const answer=q.choices[q.a];
    if(val===answer){ state.score++; $('#explain').textContent='✅ Richtig'; }
    else { $('#explain').textContent=`❌ Falsch. Richtig wäre: "${answer}". ${q.exp}`; }
  }

  function showResult(){ $('#quiz').classList.add('hidden'); $('#result').classList.remove('hidden'); $('#finalScore').textContent=`${state.score}/${state.pool.length}`; }

  // Controls
  $('#startBtn').addEventListener('click',()=>{
    if(state.selectedTenses.size===0){ alert('Bitte wähle mindestens eine Zeitform/Kategorie'); return; }
    $('#startScreen').classList.add('hidden'); $('#quiz').classList.remove('hidden'); buildPool(); nextQuestion();
  });

  $('#nextBtn').addEventListener('click',()=>{ state.idx++; state.locked=false; if(state.idx>=state.pool.length) showResult(); else nextQuestion(); });
  $('#checkBtn').addEventListener('click',()=>{ pickWrite(); $('#checkBtn').classList.add('hidden'); $('#nextBtn').classList.remove('hidden'); });
  $('#retryBtn').addEventListener('click',()=>{ buildPool(); state.idx=0; state.locked=false; $('#result').classList.add('hidden'); $('#quiz').classList.remove('hidden'); nextQuestion(); });
  $('#homeBtn').addEventListener('click',()=>{ $('#result').classList.add('hidden'); $('#startScreen').classList.remove('hidden'); });
  </script>
</body>
</html>
