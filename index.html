<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>English Grammar Trainer - Complete</title>
  <style>
    :root{
      --bg:#0f172a;--text:#e5e7eb;--accent:#22d3ee;--accent2:#a78bfa;--good:#34d399;--bad:#f87171;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;display:flex;justify-content:center}
    .app{width:100%;max-width:820px;padding:16px 16px 80px}
    h1{font-size:24px;text-align:center;margin:20px 0}
    .card{background:rgba(255,255,255,.05);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:20px}
    button,input{appearance:none;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.08);color:var(--text);padding:14px 20px;border-radius:12px;font-weight:600;cursor:pointer}
    input{width:100%}
    .choice{display:block;width:100%;margin:6px 0}
    .choice.correct{border-color:var(--good);background:rgba(52,211,153,.14)}
    .choice.wrong{border-color:var(--bad);background:rgba(248,113,113,.14)}
    .progress{height:10px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden;margin:10px 0}
    .progress>div{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0}
    .hidden{display:none}
    .chips{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:10px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.1);font-size:14px;cursor:pointer}
    .chip.active{border-color:var(--accent);background:rgba(34,211,238,.25)}
    #explain{margin-top:10px;font-size:14px;color:#cbd5e1;text-align:center}
    /* Explanation panel */
    .explain-panel{margin-top:12px;text-align:left;border:1px solid rgba(255,255,255,.18);border-radius:12px;padding:12px;background:rgba(255,255,255,.06)}
    .explain-panel.ok{border-color:var(--good);background:rgba(52,211,153,.08)}
    .explain-panel.err{border-color:var(--bad);background:rgba(248,113,113,.08)}
    .ex-header{font-weight:700;margin:2px 0 8px 0;color:#e5e7eb}
    .ex-list{list-style:none;margin:0;padding:0}
    .ex-list li{margin:4px 0;padding:6px 8px;border-radius:8px}
    .ex-list li.good{border:1px solid rgba(52,211,153,.35);background:rgba(52,211,153,.10)}
    .ex-list li.bad{border:1px solid rgba(248,113,113,.35);background:rgba(248,113,113,.10)}
    \.ex-list li.good::before{content:"✓ ";color:var(--good);font-weight:700}
    \.ex-list li.bad::before{content:"✗ ";color:var(--bad);font-weight:700}
  </style>
</head>
<body>
  <div class="app">
    <section class="card" id="startScreen">
      <h1>English Grammar Trainer - Complete</h1>
      <p style="text-align:center">Alle wichtigen englischen Zeitformen mit 120 Aufgaben. Wähle Modus und Kategorien.</p>

      <h3>Modus auswählen</h3>
      <div class="chips" id="modeChips"></div>
      <p style="font-size:12px;text-align:center">Learn = mit Erklärungen • Practice = schneller • Test = Ergebnis am Schluss • Blind = ohne Hinweise • Write = selbst schreiben</p>

      <h3>Kategorien auswählen</h3>
      <div class="chips" id="tenseChips"></div>

      <div class="row">
        <button id="startBtn">Start Training</button>
      </div>
    </section>

    <section class="card hidden" id="quiz">
      <div class="progress"><div id="progBar"></div></div>
      <h2 id="qText"></h2>
      <div id="choices"></div>
      <div id="explain"></div>
      <div class="row"><button id="checkBtn" class="hidden">Prüfen</button><button id="nextBtn">Weiter</button></div>
    </section>

    <section class="card hidden" id="result">
      <h2>Dein Ergebnis</h2>
      <p id="finalScore">0/0</p>
      <div class="row"><button id="retryBtn">Nochmal</button><button id="homeBtn">Home</button></div>
    </section>
  </div>

  <script>
  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  // COMPLETE GRAMMAR BANK - 120 Questions
  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  const BANK=[
    // PRESENT TENSES (Simple & Continuous) - 1-10
    {q:"I usually _____ coffee at breakfast. (drink)",choices:["drink","drinks","am drinking"],a:0,tenses:["presentSimple"],exp:"âœ“ drink - I + usually â†’ Present Simple base form | âœ— drinks - falsch: 'I' braucht kein -s | âœ— am drinking - falsch: usually = Gewohnheit, nicht momentan"},
    {q:"Listen! The neighbours _____ the piano right now. (play)",choices:["are playing","play","plays"],a:0,tenses:["presentCont"],exp:"âœ“ are playing - Listen! + right now â†’ Present Continuous | âœ— play - falsch: Present Simple nicht fÃ¼r momentane Handlung | âœ— plays - falsch: 3. Person + falsches Tempus"},
    {q:"She _____ to work by bus every day. (go)",choices:["goes","go","is going"],a:0,tenses:["presentSimple"],exp:"âœ“ goes - She + every day â†’ Present Simple 3. Person mit -s | âœ— go - falsch: 3. Person braucht -s | âœ— is going - falsch: every day = Gewohnheit, nicht momentan"},
    {q:"We can't talk; I _____ for my exam at the moment. (study)",choices:["am studying","study","studies"],a:0,tenses:["presentCont"],exp:"âœ“ am studying - at the moment â†’ Present Continuous | âœ— study - falsch: Present Simple nicht fÃ¼r momentane Handlung | âœ— studies - falsch: 'I' mit 3. Person Form"},
    {q:"What time _____ the shop _____? (open)",choices:["does / open","do / open","is / opening"],a:0,tenses:["presentSimple"],exp:"âœ“ does / open - Frage Present Simple: What time does it open? | âœ— do / open - falsch: 'shop' ist 3. Person Singular | âœ— is / opening - falsch: Ã–ffnungszeiten sind Fakten, nicht momentane Handlungen"},
    {q:"Why _____ you _____? You look upset. (cry)",choices:["are / crying","do / cry","does / cry"],a:0,tenses:["presentCont"],exp:"âœ“ are / crying - right now situation â†’ Present Continuous | âœ— do / cry - falsch: momentane Handlung, nicht Gewohnheit | âœ— does / cry - falsch: 'you' mit 3. Person Form"},
    {q:"My dad _____ meat, so we often cook veggie food. (not eat)",choices:["doesn't eat","don't eat","isn't eating"],a:0,tenses:["presentSimple"],exp:"âœ“ doesn't eat - My dad (3. Person) + Gewohnheit â†’ Present Simple negativ | âœ— don't eat - falsch: 3. Person braucht doesn't | âœ— isn't eating - falsch: allgemeine Tatsache, nicht momentan"},
    {q:"Be quiet! The baby _____. (sleep)",choices:["is sleeping","sleeps","sleep"],a:0,tenses:["presentCont"],exp:"âœ“ is sleeping - Be quiet! â†’ momentane Handlung â†’ Present Continuous | âœ— sleeps - falsch: momentane Handlung, nicht Gewohnheit | âœ— sleep - falsch: 3. Person + falsches Tempus"},
    {q:"How often _____ you _____ your grandparents? (visit)",choices:["do / visit","are / visiting","does / visit"],a:0,tenses:["presentSimple"],exp:"âœ“ do / visit - How often â†’ HÃ¤ufigkeit â†’ Present Simple | âœ— are / visiting - falsch: HÃ¤ufigkeit, nicht momentane Handlung | âœ— does / visit - falsch: 'you' mit 3. Person Form"},
    {q:"They usually _____ tennis on Saturdays, but today they _____ football. (play/play)",choices:["play / are playing","are playing / play","plays / plays"],a:0,tenses:["mixed"],exp:"âœ“ play / are playing - usually = Present Simple, today = Present Continuous | âœ— are playing / play - falsch: Zeiten vertauscht | âœ— plays / plays - falsch: 'they' ist Plural"},

    // PAST SIMPLE & PAST CONTINUOUS - 11-20
    {q:"I _____ the news when my phone _____. (watch/ring)",choices:["was watching / rang","watched / was ringing","watched / rang"],a:0,tenses:["pastCont"],exp:"âœ“ was watching / rang - Handlung im Verlauf + plÃ¶tzliches Ereignis | âœ— watched / was ringing - falsch: Zeiten vertauscht | âœ— watched / rang - falsch: beide Past Simple"},
    {q:"While we _____ home, it suddenly _____ to rain. (walk/start)",choices:["were walking / started","walked / was starting","walked / started"],a:0,tenses:["pastCont"],exp:"âœ“ were walking / started - While = andauernde Handlung + suddenly = plÃ¶tzliches Ereignis | âœ— walked / was starting - falsch: Zeiten vertauscht | âœ— walked / started - falsch: beide Past Simple"},
    {q:"She _____ her keys yesterday. (lose)",choices:["lost","was losing","has lost"],a:0,tenses:["pastSimple"],exp:"âœ“ lost - yesterday â†’ Past Simple | âœ— was losing - falsch: keine andauernde Handlung | âœ— has lost - falsch: Present Perfect nicht mit yesterday"},
    {q:"What _____ you _____ when the accident _____? (do/happen)",choices:["were / doing / happened","did / do / was happening","did / do / happened"],a:0,tenses:["pastCont"],exp:"âœ“ were / doing / happened - Was warst du dabei zu tun? + plÃ¶tzliches Ereignis | âœ— did / do / was happening - falsch: Zeiten vertauscht | âœ— did / do / happened - falsch: beide Past Simple"},
    {q:"We _____ dinner when Tom _____. (have/arrive)",choices:["were having / arrived","had / was arriving","had / arrived"],a:0,tenses:["pastCont"],exp:"âœ“ were having / arrived - andauernde Handlung + plÃ¶tzliche Unterbrechung | âœ— had / was arriving - falsch: Zeiten vertauscht | âœ— had / arrived - falsch: beide Past Simple"},
    {q:"He _____ fast, so the police _____ him. (drive/stop)",choices:["was driving / stopped","drove / was stopping","drove / stopped"],a:0,tenses:["pastCont"],exp:"âœ“ was driving / stopped - er war dabei zu fahren + police stopped = Unterbrechung | âœ— drove / was stopping - falsch: police stop ist plÃ¶tzlich | âœ— drove / stopped - falsch: beide Past Simple"},
    {q:"I _____ my leg while I _____ basketball. (break/play)",choices:["broke / was playing","was breaking / played","broke / played"],a:0,tenses:["pastCont"],exp:"âœ“ broke / was playing - plÃ¶tzlicher Unfall wÃ¤hrend andauernder AktivitÃ¤t | âœ— was breaking / played - falsch: Unfall ist plÃ¶tzlich | âœ— broke / played - falsch: beide Past Simple"},
    {q:"They _____ at 7 a.m. and _____ at 9 a.m. (leave/arrive)",choices:["left / arrived","were leaving / were arriving","left / were arriving"],a:0,tenses:["pastSimple"],exp:"âœ“ left / arrived - zwei aufeinanderfolgende abgeschlossene Handlungen | âœ— were leaving / were arriving - falsch: keine andauernden Handlungen | âœ— left / were arriving - falsch: mixed ohne Grund"},
    {q:"She _____ the door when I _____. (open/knock)",choices:["opened / knocked","was opening / knocked","opened / was knocking"],a:0,tenses:["pastSimple"],exp:"âœ“ opened / knocked - zwei aufeinanderfolgende Handlungen | âœ— was opening / knocked - falsch: Ã¶ffnen ist schnell | âœ— opened / was knocking - falsch: klopfen ist kurz"},
    {q:"It _____ all night, so the roads _____ dangerous. (rain/be)",choices:["rained / were","was raining / were","rained / was"],a:0,tenses:["pastSimple"],exp:"âœ“ rained / were - all night = Dauer, aber abgeschlossen + Resultat | âœ— was raining / were - Past Continuous mÃ¶glich, aber Past Simple hÃ¤ufiger | âœ— rained / was - falsch: roads ist Plural"},

    // PRESENT PERFECT SIMPLE - 21-30
    {q:"I _____ already _____ my homework. (finish)",choices:["have / finished","had / finished","am / finishing"],a:0,tenses:["presentPerf"],exp:"âœ“ have / finished - already â†’ Present Perfect | âœ— had / finished - falsch: Past Perfect braucht Bezug zu Vergangenheit | âœ— am / finishing - falsch: already nicht mit Present Continuous"},
    {q:"_____ you ever _____ sushi? (try)",choices:["Have / tried","Did / try","Are / trying"],a:0,tenses:["presentPerf"],exp:"âœ“ Have / tried - ever â†’ Present Perfect (Erfahrung) | âœ— Did / try - falsch: Past Simple nicht fÃ¼r Erfahrung ohne Zeitangabe | âœ— Are / trying - falsch: ever nicht mit Present Continuous"},
    {q:"We _____ just _____ the new teacher. (meet)",choices:["have / met","had / met","are / meeting"],a:0,tenses:["presentPerf"],exp:"âœ“ have / met - just â†’ Present Perfect | âœ— had / met - falsch: Past Perfect ohne Bezug | âœ— are / meeting - falsch: just nicht mit Present Continuous"},
    {q:"She _____ in Berlin _____ 2018. (live)",choices:["has lived / since","lived / since","has been living / since"],a:0,tenses:["presentPerf"],exp:"âœ“ has lived / since - since 2018 â†’ Present Perfect | âœ— lived / since - falsch: Past Simple nicht mit since | âœ— has been living / since - richtig, aber Simple hÃ¤ufiger bei since"},
    {q:"They _____ their tickets yet. (not buy)",choices:["haven't bought","didn't buy","aren't buying"],a:0,tenses:["presentPerf"],exp:"âœ“ haven't bought - yet â†’ Present Perfect negativ | âœ— didn't buy - falsch: Past Simple nicht mit yet | âœ— aren't buying - falsch: yet nicht mit Present Continuous"},
    {q:"He _____ three goals this season. (score)",choices:["has scored","scored","is scoring"],a:0,tenses:["presentPerf"],exp:"âœ“ has scored - this season â†’ Present Perfect (Zeitraum bis jetzt) | âœ— scored - falsch: Past Simple nicht fÃ¼r andauernden Zeitraum | âœ— is scoring - falsch: nicht momentane Handlung"},
    {q:"How long _____ you _____ at this company? (work)",choices:["have / worked","did / work","are / working"],a:0,tenses:["presentPerf"],exp:"âœ“ have / worked - How long â†’ Present Perfect (Dauer bis jetzt) | âœ— did / work - falsch: Past Simple nicht fÃ¼r Dauer bis jetzt | âœ— are / working - falsch: How long nicht mit Present Continuous"},
    {q:"I _____ never _____ to Morocco. (be)",choices:["have / been","had / been","am / being"],a:0,tenses:["presentPerf"],exp:"âœ“ have / been - never â†’ Present Perfect (Erfahrung) | âœ— had / been - falsch: Past Perfect ohne Bezug | âœ— am / being - falsch: never nicht mit Present Continuous"},
    {q:"The film _____ already _____. Let's go! (start)",choices:["has / started","had / started","is / starting"],a:0,tenses:["presentPerf"],exp:"âœ“ has / started - already + Let's go! â†’ Present Perfect | âœ— had / started - falsch: Past Perfect ohne Vergangenheitsbezug | âœ— is / starting - falsch: already nicht mit Present Continuous"},
    {q:"My sister _____ her ankle again. (sprain)",choices:["has sprained","sprained","is spraining"],a:0,tenses:["presentPerf"],exp:"âœ“ has sprained - again â†’ Present Perfect (wiederholte Erfahrung) | âœ— sprained - Past Simple mÃ¶glich, aber Present Perfect hÃ¤ufiger bei 'again' | âœ— is spraining - falsch: nicht momentane Handlung"},

    // PRESENT PERFECT CONTINUOUS - 31-40
    {q:"How long _____ you _____ English? (study)",choices:["have / been studying","are / studying","did / study"],a:0,tenses:["presentPerfCont"],exp:"âœ“ have / been studying - How long â†’ Present Perfect Continuous (Dauer bis jetzt) | âœ— are / studying - falsch: Present Continuous nicht mit How long | âœ— did / study - falsch: Past Simple nicht fÃ¼r Dauer bis jetzt"},
    {q:"She's tired because she _____ all morning. (clean)",choices:["has been cleaning","is cleaning","cleaned"],a:0,tenses:["presentPerfCont"],exp:"âœ“ has been cleaning - all morning â†’ Present Perfect Continuous (Resultat sichtbar) | âœ— is cleaning - falsch: nicht nur momentan | âœ— cleaned - falsch: Past Simple zeigt nicht die Verbindung zur Gegenwart"},
    {q:"We _____ for the bus since 8:30. (wait)",choices:["have been waiting","are waiting","waited"],a:0,tenses:["presentPerfCont"],exp:"âœ“ have been waiting - since 8:30 â†’ Present Perfect Continuous | âœ— are waiting - falsch: Present Continuous nicht mit since | âœ— waited - falsch: Past Simple nicht mit since"},
    {q:"It _____ all day; look at the puddles. (rain)",choices:["has been raining","is raining","rained"],a:0,tenses:["presentPerfCont"],exp:"âœ“ has been raining - all day + look at puddles â†’ Present Perfect Continuous (sichtbares Resultat) | âœ— is raining - falsch: nicht nur momentan | âœ— rained - falsch: Past Simple zeigt nicht Verbindung zur Gegenwart"},
    {q:"He _____ a lot recently, so he's fitter. (run)",choices:["has been running","is running","ran"],a:0,tenses:["presentPerfCont"],exp:"âœ“ has been running - recently + so he's fitter â†’ Present Perfect Continuous (Resultat) | âœ— is running - falsch: recently nicht mit Present Continuous | âœ— ran - falsch: Past Simple zeigt nicht die Verbindung"},
    {q:"I _____ to call you, but you were busy. (try)",choices:["have been trying","am trying","tried"],a:0,tenses:["presentPerfCont"],exp:"âœ“ have been trying - wiederholte Versuche bis jetzt â†’ Present Perfect Continuous | âœ— am trying - falsch: nicht nur momentan | âœ— tried - Past Simple mÃ¶glich, aber Continuous zeigt mehr Anstrengung"},
    {q:"Why are your hands dirty? â€“ I _____ the bike. (fix)",choices:["have been fixing","am fixing","fixed"],a:0,tenses:["presentPerfCont"],exp:"âœ“ have been fixing - dirty hands = sichtbares Resultat â†’ Present Perfect Continuous | âœ— am fixing - falsch: nicht momentan, sondern Resultat | âœ— fixed - falsch: Past Simple erklÃ¤rt nicht die schmutzigen HÃ¤nde jetzt"},
    {q:"They _____ about moving to Spain for months. (talk)",choices:["have been talking","are talking","talked"],a:0,tenses:["presentPerfCont"],exp:"âœ“ have been talking - for months â†’ Present Perfect Continuous (Dauer) | âœ— are talking - falsch: Present Continuous nicht mit for months | âœ— talked - falsch: Past Simple nicht fÃ¼r Dauer bis jetzt"},
    {q:"She _____ well lately. (not sleep)",choices:["hasn't been sleeping","isn't sleeping","didn't sleep"],a:0,tenses:["presentPerfCont"],exp:"âœ“ hasn't been sleeping - lately â†’ Present Perfect Continuous negativ | âœ— isn't sleeping - falsch: lately nicht mit Present Continuous | âœ— didn't sleep - falsch: Past Simple nicht mit lately"},
    {q:"We _____ too much money this week. (spend)",choices:["have been spending","are spending","spent"],a:0,tenses:["presentPerfCont"],exp:"âœ“ have been spending - this week â†’ Present Perfect Continuous (Zeitraum bis jetzt) | âœ— are spending - falsch: this week nicht mit Present Continuous | âœ— spent - Past Simple mÃ¶glich, aber Continuous betont die KontinuitÃ¤t"},

    // PAST PERFECT (Simple & Continuous) - 41-50
    {q:"When we arrived, they _____ already _____. (leave)",choices:["had / left","have / left","were / leaving"],a:0,tenses:["pastPerf"],exp:"âœ“ had / left - When we arrived = Vergangenheit, they left davor â†’ Past Perfect | âœ— have / left - falsch: Present Perfect nicht in VergangenheitserzÃ¤hlung | âœ— were / leaving - falsch: Past Continuous zeigt nicht 'schon weg'"},
    {q:"She was nervous because she _____ never _____ alone before. (fly)",choices:["had / flown","has / flown","was / flying"],a:0,tenses:["pastPerf"],exp:"âœ“ had / flown - before = Vorvergangenheit â†’ Past Perfect | âœ— has / flown - falsch: Present Perfect nicht in VergangenheitserzÃ¤hlung | âœ— was / flying - falsch: Past Continuous passt nicht zu never before"},
    {q:"I couldn't open the file; I _____ the password. (forget)",choices:["had forgotten","forgot","was forgetting"],a:0,tenses:["pastPerf"],exp:"âœ“ had forgotten - couldn't open (Vergangenheit) + forgot davor â†’ Past Perfect | âœ— forgot - Past Simple mÃ¶glich, aber Past Perfect zeigt Reihenfolge klarer | âœ— was forgetting - falsch: vergessen ist nicht andauernd"},
    {q:"He _____ for two hours when the coach ended training. (run)",choices:["had been running","was running","ran"],a:0,tenses:["pastPerfCont"],exp:"âœ“ had been running - for two hours + when coach ended â†’ Past Perfect Continuous | âœ— was running - falsch: zeigt nicht die Dauer von 2 Stunden | âœ— ran - falsch: Past Simple zeigt nicht Dauer + Vorvergangenheit"},
    {q:"They were wet because it _____ for ages. (rain)",choices:["had been raining","was raining","rained"],a:0,tenses:["pastPerfCont"],exp:"âœ“ had been raining - were wet (Resultat) + for ages â†’ Past Perfect Continuous | âœ— was raining - falsch: Past Continuous zeigt nicht die lange Dauer davor | âœ— rained - falsch: Past Simple zeigt nicht Dauer"},
    {q:"The waiter _____ our order twice before the food came. (check)",choices:["had checked","checked","was checking"],a:0,tenses:["pastPerf"],exp:"âœ“ had checked - twice before the food came â†’ Past Perfect (Vorvergangenheit) | âœ— checked - Past Simple mÃ¶glich, aber Past Perfect zeigt Reihenfolge | âœ— was checking - falsch: checking ist schnell, nicht andauernd"},
    {q:"After I _____ my homework, I watched TV. (finish)",choices:["had finished","finished","was finishing"],a:0,tenses:["pastPerf"],exp:"âœ“ had finished - After = Reihenfolge â†’ Past Perfect | âœ— finished - Past Simple mÃ¶glich, aber Past Perfect ist korrekter nach 'after' | âœ— was finishing - falsch: finish ist nicht andauernd"},
    {q:"She _____ not _____ him before that party. (meet)",choices:["had / met","did / meet","was / meeting"],a:0,tenses:["pastPerf"],exp:"âœ“ had / met - before that party â†’ Past Perfect negativ | âœ— did / meet - falsch: Past Simple negativ nicht mit before | âœ— was / meeting - falsch: meet ist nicht andauernd"},
    {q:"We were late: the film _____ already _____. (start)",choices:["had / started","has / started","was / starting"],a:0,tenses:["pastPerf"],exp:"âœ“ had / started - were late (Vergangenheit) + film started davor â†’ Past Perfect | âœ— has / started - falsch: Present Perfect nicht in VergangenheitserzÃ¤hlung | âœ— was / starting - falsch: start ist schnell"},
    {q:"He looked tired; he _____ all night. (work)",choices:["had been working","was working","worked"],a:0,tenses:["pastPerfCont"],exp:"âœ“ had been working - looked tired (Resultat) + all night â†’ Past Perfect Continuous | âœ— was working - falsch: Past Continuous zeigt nicht die komplette Nacht davor | âœ— worked - falsch: Past Simple zeigt nicht die Dauer"},

    // FUTURE (will / going to / arrangements) - 51-60
    {q:"Look at those clouds! It _____ soon. (rain)",choices:["is going to rain","will rain","rains"],a:0,tenses:["futureGoingTo"],exp:"âœ“ is going to rain - Look at clouds = sichtbare Anzeichen â†’ going to | âœ— will rain - falsch: will fÃ¼r spontane Entscheidungen | âœ— rains - falsch: Present Simple nicht fÃ¼r Zukunft"},
    {q:"I think I _____ to bed early tonight. (go)",choices:["will go","am going to go","go"],a:0,tenses:["futureWill"],exp:"âœ“ will go - I think = Meinung/Entscheidung â†’ will | âœ— am going to go - falsch: going to fÃ¼r feste PlÃ¤ne | âœ— go - falsch: Present Simple nicht fÃ¼r ZukunftsplÃ¤ne"},
    {q:"We _____ our grandparents on Sunday at 3 p.m. (visit)",choices:["are visiting","will visit","are going to visit"],a:0,tenses:["futureArrangement"],exp:"âœ“ are visiting - Sunday at 3 p.m. = fester Termin â†’ Present Continuous fÃ¼r arrangements | âœ— will visit - falsch: will fÃ¼r spontane Entscheidungen | âœ— are going to visit - going to mÃ¶glich, aber Present Continuous hÃ¤ufiger bei festen Terminen"},
    {q:"Don't worry, I _____ you with the bags. (help)",choices:["will help","am going to help","help"],a:0,tenses:["futureWill"],exp:"âœ“ will help - Don't worry = spontanes Angebot â†’ will | âœ— am going to help - falsch: going to fÃ¼r geplante Aktionen | âœ— help - falsch: Present Simple nicht fÃ¼r Angebote"},
    {q:"We've bought the tickets; we _____ to Rome next Friday. (fly)",choices:["are flying","will fly","are going to fly"],a:0,tenses:["futureArrangement"],exp:"âœ“ are flying - bought tickets + next Friday = fester Plan â†’ Present Continuous | âœ— will fly - falsch: will fÃ¼r spontane Entscheidungen | âœ— are going to fly - going to mÃ¶glich, aber Present Continuous hÃ¤ufiger bei gebuchten Tickets"},
    {q:"He's made up his mind: he _____ a new phone. (buy)",choices:["is going to buy","will buy","buys"],a:0,tenses:["futureGoingTo"],exp:"âœ“ is going to buy - made up his mind = feste Absicht â†’ going to | âœ— will buy - falsch: will fÃ¼r spontane Entscheidungen | âœ— buys - falsch: Present Simple nicht fÃ¼r ZukunftsplÃ¤ne"},
    {q:"Are you free at six? â€“ Sorry, I _____ my dentist then. (see)",choices:["am seeing","will see","see"],a:0,tenses:["futureArrangement"],exp:"âœ“ am seeing - dentist at six = fester Termin â†’ Present Continuous | âœ— will see - falsch: will fÃ¼r spontane Entscheidungen | âœ— see - falsch: Present Simple zeigt nicht Zukunft"},
    {q:"Be careful or you _____ your coffee. (spill)",choices:["will spill","are going to spill","spill"],a:0,tenses:["futureWill"],exp:"âœ“ will spill - Be careful or = Warnung/Vorhersage â†’ will | âœ— are going to spill - going to mÃ¶glich, aber will hÃ¤ufiger bei Warnungen | âœ— spill - falsch: Present Simple nicht fÃ¼r Warnungen"},
    {q:"What time _____ the meeting _____? (start)",choices:["does / start","will / start","is / going to start"],a:0,tenses:["futureSchedule"],exp:"âœ“ does / start - meeting time = fester Zeitplan â†’ Present Simple | âœ— will / start - falsch: will nicht fÃ¼r feste ZeitplÃ¤ne | âœ— is / going to start - falsch: going to nicht fÃ¼r ZeitplÃ¤ne"},
    {q:"I promise I _____ late again. (not be)",choices:["won't be","am not going to be","am not"],a:0,tenses:["futureWill"],exp:"âœ“ won't be - I promise = Versprechen â†’ will (negativ) | âœ— am not going to be - falsch: going to nicht fÃ¼r Versprechen | âœ— am not - falsch: Present Simple nicht fÃ¼r Zukunftsversprechen"},

    // MODALS - 61-70
    {q:"When I was a child, I _____ swim very well. (ability past)",choices:["could","can","was able to"],a:0,tenses:["modals"],exp:"âœ“ could - When I was a child = Vergangenheit â†’ could fÃ¼r frÃ¼here FÃ¤higkeit | âœ— can - falsch: can fÃ¼r Gegenwart | âœ— was able to - richtig, aber could hÃ¤ufiger"},
    {q:"You _____ wear a seat belt in the car. (obligation)",choices:["must","should","can"],a:0,tenses:["modals"],exp:"âœ“ must - seat belt = gesetzliche Pflicht â†’ must | âœ— should - falsch: should nur Empfehlung | âœ— can - falsch: can fÃ¼r Erlaubnis"},
    {q:"You _____ see a doctor; that cough sounds bad. (advice)",choices:["should","must","can"],a:0,tenses:["modals"],exp:"âœ“ should - Ratschlag â†’ should | âœ— must - falsch: must zu stark fÃ¼r Ratschlag | âœ— can - falsch: can fÃ¼r FÃ¤higkeit/Erlaubnis"},
    {q:"_____ I open the window? (permission)",choices:["May","Can","Must"],a:0,tenses:["modals"],exp:"âœ“ May - hÃ¶fliche Bitte um Erlaubnis â†’ May | âœ— Can - Can mÃ¶glich, aber May hÃ¶flicher | âœ— Must - falsch: must fÃ¼r Pflicht"},
    {q:"It _____ rain later; take an umbrella. (possibility)",choices:["might","must","will"],a:0,tenses:["modals"],exp:"âœ“ might - MÃ¶glichkeit (nicht sicher) â†’ might | âœ— must - falsch: must fÃ¼r starke Vermutung | âœ— will - falsch: will fÃ¼r sichere Zukunft"},
    {q:"Employees _____ arrive before 9 a.m. (external obligation)",choices:["have to","must","should"],a:0,tenses:["modals"],exp:"âœ“ have to - externe Regel (Firma) â†’ have to | âœ— must - must fÃ¼r persÃ¶nliche Ãœberzeugung | âœ— should - falsch: should nur Empfehlung"},
    {q:"He _____ play the guitar, but not the piano. (ability)",choices:["can","could","must"],a:0,tenses:["modals"],exp:"âœ“ can - Gegenwart + FÃ¤higkeit â†’ can | âœ— could - falsch: could fÃ¼r Vergangenheit | âœ— must - falsch: must fÃ¼r Pflicht"},
    {q:"You _____ smoke here; it's forbidden. (prohibition)",choices:["must not","don't have to","shouldn't"],a:0,tenses:["modals"],exp:"âœ“ must not - Verbot â†’ must not | âœ— don't have to - falsch: bedeutet 'nicht nÃ¶tig' | âœ— shouldn't - falsch: shouldn't nur Empfehlung"},
    {q:"I _____ finish this tonight, but I'm not sure. (possibility)",choices:["might","must","will"],a:0,tenses:["modals"],exp:"âœ“ might - but I'm not sure = unsicher â†’ might | âœ— must - falsch: must fÃ¼r starke Vermutung | âœ— will - falsch: will fÃ¼r sichere Zukunft"},
    {q:"She _____ have taken the wrong train. (deduction)",choices:["may","can","will"],a:0,tenses:["modals"],exp:"âœ“ may - Vermutung Ã¼ber Vergangenheit â†’ may have + past participle | âœ— can - can have nicht fÃ¼r Vermutungen | âœ— will - falsch: will have fÃ¼r Future Perfect"},

    // USED TO / BE USED TO / WOULD - 71-75  
    {q:"I _____ play football every day when I was ten. (past habit)",choices:["used to","am used to","would"],a:0,tenses:["usedTo"],exp:"âœ“ used to - when I was ten = frÃ¼here Gewohnheit â†’ used to | âœ— am used to - falsch: be used to = gewÃ¶hnt sein | âœ— would - would mÃ¶glich, aber used to hÃ¤ufiger fÃ¼r Gewohnheiten"},
    {q:"She _____ living in a big city now. (accustomed)",choices:["is used to","used to","would"],a:0,tenses:["usedTo"],exp:"âœ“ is used to - now = gewÃ¶hnt sein an â†’ be used to | âœ— used to - falsch: used to fÃ¼r Vergangenheit | âœ— would - falsch: would fÃ¼r Vergangenheitsgewohnheiten"},
    {q:"We _____ to school together back then. (repeated past action)",choices:["would walk","used to walk","are used to walking"],a:0,tenses:["usedTo"],exp:"âœ“ would walk - back then + repeated action â†’ would | âœ— used to walk - used to mÃ¶glich, aber would betont Wiederholung | âœ— are used to walking - falsch: be used to fÃ¼r Gewohnheit, nicht Vergangenheit"},
    {q:"He didn't _____ spicy food, but now he loves it. (negative past habit)",choices:["use to eat","used to eat","used to eating"],a:0,tenses:["usedTo"],exp:"âœ“ use to eat - didn't + use to (ohne -d) | âœ— used to eat - falsch: nach didn't kein -d | âœ— used to eating - falsch: used to + base form"},
    {q:"Are you _____ getting up early? (question - accustomed)",choices:["used to","use to","used for"],a:0,tenses:["usedTo"],exp:"âœ“ used to - Are you used to = Bist du gewÃ¶hnt an? â†’ used to | âœ— use to - falsch: nur nach didn't | âœ— used for - falsch: used for = verwendet fÃ¼r"},

    // QUESTIONS & NEGATIONS - 76-80
    {q:"_____ you _____ the letter yet? (present perfect question)",choices:["Have / sent","Did / send","Are / sending"],a:0,tenses:["questions"],exp:"âœ“ Have / sent - yet â†’ Present Perfect Frage | âœ— Did / send - falsch: Past Simple nicht mit yet | âœ— Are / sending - falsch: Present Continuous nicht mit yet"},
    {q:"Why _____ she _____ to the meeting yesterday? (past simple negative question)",choices:["didn't / come","doesn't / come","hasn't / come"],a:0,tenses:["questions"],exp:"âœ“ didn't / come - yesterday + Frage â†’ Past Simple negativ | âœ— doesn't / come - falsch: Present Simple nicht mit yesterday | âœ— hasn't / come - falsch: Present Perfect nicht mit yesterday"},
    {q:"What _____ you _____ at 8 p.m. last night? (past continuous question)",choices:["were / doing","did / do","are / doing"],a:0,tenses:["questions"],exp:"âœ“ were / doing - at 8 p.m. last night â†’ Past Continuous Frage | âœ— did / do - falsch: Past Simple nicht fÃ¼r Zeitpunkt | âœ— are / doing - falsch: Present Continuous nicht fÃ¼r Vergangenheit"},
    {q:"_____ they _____ the report by Friday? (future question)",choices:["Will / have finished","Do / finish","Are / finishing"],a:0,tenses:["questions"],exp:"âœ“ Will / have finished - by Friday â†’ Future Perfect | âœ— Do / finish - falsch: Present Simple nicht fÃ¼r Zukunft | âœ— Are / finishing - falsch: Present Continuous nicht mit by Friday"},
    {q:"He _____ in Paris since March, _____ he? (question tag)",choices:["has lived / hasn't","lived / didn't","lives / doesn't"],a:0,tenses:["questions"],exp:"âœ“ has lived / hasn't - since March â†’ Present Perfect + negative tag | âœ— lived / didn't - falsch: Past Simple nicht mit since | âœ— lives / doesn't - falsch: Present Simple nicht mit since"},

    // CONDITIONALS & WISHES - 81-90
    {q:"If water _____ at 100Â°C, it turns to steam. (zero conditional)",choices:["boils","boiled","will boil"],a:0,tenses:["conditionals"],exp:"âœ“ boils - Zero Conditional = Naturgesetz â†’ Present Simple + Present Simple | âœ— boiled - falsch: Past Simple nicht fÃ¼r Naturgesetze | âœ— will boil - falsch: will nicht in Zero Conditional"},
    {q:"If I see her, I _____ her the message. (first conditional)",choices:["will tell","tell","would tell"],a:0,tenses:["conditionals"],exp:"âœ“ will tell - First Conditional: If + Present Simple, will + base | âœ— tell - falsch: Present Simple nicht im Hauptsatz | âœ— would tell - falsch: would fÃ¼r Second Conditional"},
    {q:"If I _____ more time, I would learn Italian. (second conditional)",choices:["had","have","will have"],a:0,tenses:["conditionals"],exp:"âœ“ had - Second Conditional: If + Past Simple, would + base | âœ— have - falsch: Present Simple fÃ¼r First Conditional | âœ— will have - falsch: will fÃ¼r First Conditional"},
    {q:"If they _____ earlier, they wouldn't have missed the bus. (third conditional)",choices:["had left","left","leave"],a:0,tenses:["conditionals"],exp:"âœ“ had left - Third Conditional: If + Past Perfect, would have + past participle | âœ— left - falsch: Past Simple fÃ¼r Second Conditional | âœ— leave - falsch: Present Simple fÃ¼r First Conditional"},
    {q:"If you had studied, you _____ the exam. (third conditional)",choices:["would have passed","will pass","would pass"],a:0,tenses:["conditionals"],exp:"âœ“ would have passed - Third Conditional: would have + past participle | âœ— will pass - falsch: will fÃ¼r First Conditional | âœ— would pass - falsch: would + base fÃ¼r Second Conditional"},
    {q:"I wish I _____ taller. (wish about present)",choices:["were","am","will be"],a:0,tenses:["conditionals"],exp:"âœ“ were - wish about present â†’ Past Simple (were fÃ¼r alle Personen) | âœ— am - falsch: Present Simple nicht nach wish | âœ— will be - falsch: will nicht nach wish"},
    {q:"I wish you _____ so fast when you drive. (wish about present habit)",choices:["didn't drive","don't drive","wouldn't drive"],a:0,tenses:["conditionals"],exp:"âœ“ didn't drive - wish about habit â†’ Past Simple negativ | âœ— don't drive - falsch: Present Simple nicht nach wish | âœ— wouldn't drive - wouldn't mÃ¶glich, aber didn't hÃ¤ufiger"},
    {q:"If it _____ tomorrow, we'll stay home. (first conditional)",choices:["rains","rained","will rain"],a:0,tenses:["conditionals"],exp:"âœ“ rains - First Conditional: If + Present Simple, will + base | âœ— rained - falsch: Past Simple fÃ¼r Second Conditional | âœ— will rain - falsch: will nicht im If-Satz"},
    {q:"If I _____ you, I'd apologise. (second conditional)",choices:["were","am","will be"],a:0,tenses:["conditionals"],exp:"âœ“ were - If I were you = Second Conditional (were fÃ¼r alle Personen) | âœ— am - falsch: Present Simple fÃ¼r First Conditional | âœ— will be - falsch: will fÃ¼r First Conditional"},
    {q:"If she hadn't lost her phone, she _____ me. (third conditional)",choices:["would have called","will call","would call"],a:0,tenses:["conditionals"],exp:"âœ“ would have called - Third Conditional: would have + past participle | âœ— will call - falsch: will fÃ¼r First Conditional | âœ— would call - falsch: would + base fÃ¼r Second Conditional"},

    // PASSIVE VOICE - 91-95
    {q:"The stadium _____ in 2001. (past simple passive)",choices:["was built","built","has been built"],a:0,tenses:["passiveVoice"],exp:"âœ“ was built - in 2001 â†’ Past Simple Passive: was/were + past participle | âœ— built - falsch: Active Voice | âœ— has been built - falsch: Present Perfect Passive nicht mit Jahreszahl"},
    {q:"This song _____ by millions every week. (present simple passive)",choices:["is streamed","streams","has been streamed"],a:0,tenses:["passiveVoice"],exp:"âœ“ is streamed - every week â†’ Present Simple Passive: is/are + past participle | âœ— streams - falsch: Active Voice | âœ— has been streamed - falsch: Present Perfect Passive nicht mit every week"},
    {q:"The match _____ because of the storm. (past simple passive)",choices:["was cancelled","cancelled","has been cancelled"],a:0,tenses:["passiveVoice"],exp:"âœ“ was cancelled - Vergangenheit â†’ Past Simple Passive | âœ— cancelled - falsch: Active Voice braucht Subjekt | âœ— has been cancelled - Present Perfect Passive mÃ¶glich, aber Past Simple hÃ¤ufiger"},
    {q:"Dinner _____ now; please sit down. (present continuous passive)",choices:["is being served","is served","has been served"],a:0,tenses:["passiveVoice"],exp:"âœ“ is being served - now â†’ Present Continuous Passive: is/are being + past participle | âœ— is served - falsch: Present Simple Passive nicht fÃ¼r momentane Handlung | âœ— has been served - falsch: Present Perfect Passive nicht fÃ¼r momentane Handlung"},
    {q:"The new law _____ next month. (future passive)",choices:["will be introduced","is introduced","has been introduced"],a:0,tenses:["passiveVoice"],exp:"âœ“ will be introduced - next month â†’ Future Passive: will be + past participle | âœ— is introduced - falsch: Present Simple nicht fÃ¼r Zukunft | âœ— has been introduced - falsch: Present Perfect nicht fÃ¼r Zukunft"},

    // REPORTED SPEECH & VERB PATTERNS - 96-100
    {q:"She _____ to help me with the project. (verb pattern)",choices:["offered","suggested","recommended"],a:0,tenses:["reportedSpeech"],exp:"âœ“ offered - offer + to infinitive | âœ— suggested - falsch: suggest + -ing or that-clause | âœ— recommended - falsch: recommend + -ing or that-clause"},
    {q:"He _____ going to the cinema instead. (verb pattern)",choices:["suggested","offered","promised"],a:0,tenses:["reportedSpeech"],exp:"âœ“ suggested - suggest + -ing form | âœ— offered - falsch: offer + to infinitive | âœ— promised - falsch: promise + to infinitive"},
    {q:"They _____ to finish on time. (verb pattern)",choices:["plan","suggest","offer"],a:0,tenses:["reportedSpeech"],exp:"âœ“ plan - plan + to infinitive | âœ— suggest - falsch: suggest + -ing | âœ— offer - offer mÃ¶glich, aber plan passender zum Kontext"},
    {q:"I _____ not _____ the password. (verb pattern)",choices:["admit / remembering","admit / to remember","admit / remember"],a:0,tenses:["reportedSpeech"],exp:"âœ“ admit / remembering - admit + -ing form | âœ— admit / to remember - falsch: admit nicht mit to infinitive | âœ— admit / remember - falsch: admit braucht -ing"},
    {q:"Please _____ to lock the door before you leave. (verb pattern)",choices:["remember","remind","suggest"],a:0,tenses:["reportedSpeech"],exp:"âœ“ remember - remember + to infinitive (nicht vergessen zu tun) | âœ— remind - falsch: remind somebody to do | âœ— suggest - falsch: suggest + -ing"},

    // USUALLY & USED TO - 101-120
    {q:"I _____ coffee at 7 a.m. (drink + usually)",choices:["usually drink","drink usually","am usually drinking"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually drink - usually vor Hauptverb â†’ Present Simple | âœ— drink usually - falsch: usually nicht am Ende | âœ— am usually drinking - falsch: usually nicht mit Present Continuous"},
    {q:"She _____ to school by bus. (go + usually)",choices:["usually goes","goes usually","is usually going"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually goes - usually + 3. Person â†’ Present Simple mit -s | âœ— goes usually - falsch: usually nicht am Ende | âœ— is usually going - falsch: usually nicht mit Present Continuous"},
    {q:"We _____ our homework after dinner. (do + usually)",choices:["usually do","do usually","are usually doing"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually do - usually + Plural â†’ Present Simple base form | âœ— do usually - falsch: usually nicht am Ende | âœ— are usually doing - falsch: usually nicht mit Present Continuous"},
    {q:"He _____ very late on weekends. (sleep + usually)",choices:["usually sleeps","sleeps usually","is usually sleeping"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually sleeps - usually + 3. Person â†’ sleeps | âœ— sleeps usually - falsch: usually nicht am Ende | âœ— is usually sleeping - falsch: usually nicht mit Present Continuous"},
    {q:"They _____ coffee after lunch. (have + usually)",choices:["usually have","have usually","are usually having"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually have - usually + Plural â†’ have | âœ— have usually - falsch: usually nicht am Ende | âœ— are usually having - falsch: usually nicht mit Present Continuous"},
    {q:"My boss _____ emails in the morning. (check + usually)",choices:["usually checks","checks usually","is usually checking"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually checks - usually + 3. Person â†’ checks | âœ— checks usually - falsch: usually nicht am Ende | âœ— is usually checking - falsch: usually nicht mit Present Continuous"},
    {q:"The train _____ on time. (arrive + usually)",choices:["usually arrives","arrives usually","is usually arriving"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually arrives - usually + 3. Person â†’ arrives | âœ— arrives usually - falsch: usually nicht am Ende | âœ— is usually arriving - falsch: usually nicht mit Present Continuous"},
    {q:"I _____ music while I cook. (listen + usually)",choices:["usually listen","listen usually","am usually listening"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually listen - usually + I â†’ listen | âœ— listen usually - falsch: usually nicht am Ende | âœ— am usually listening - falsch: usually nicht mit Present Continuous"},
    {q:"Tim _____ his bike to work. (ride + usually)",choices:["usually rides","rides usually","is usually riding"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually rides - usually + 3. Person â†’ rides | âœ— rides usually - falsch: usually nicht am Ende | âœ— is usually riding - falsch: usually nicht mit Present Continuous"},
    {q:"Our teacher _____ us homework on Fridays. (give + usually)",choices:["usually gives","gives usually","is usually giving"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ usually gives - usually + 3. Person â†’ gives | âœ— gives usually - falsch: usually nicht am Ende | âœ— is usually giving - falsch: usually nicht mit Present Continuous"},
    {q:"When I was a child, I _____ in this park. (play + used to)",choices:["used to play","usually played","was used to playing"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ used to play - When I was a child â†’ used to fÃ¼r Vergangenheit | âœ— usually played - usually fÃ¼r Gegenwart, nicht Vergangenheit | âœ— was used to playing - falsch: be used to = gewÃ¶hnt sein"},
    {q:"My grandparents _____ in the countryside. (live + used to)",choices:["used to live","usually lived","were used to living"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ used to live - Vergangenheit â†’ used to | âœ— usually lived - usually fÃ¼r Gegenwart | âœ— were used to living - falsch: be used to = gewÃ¶hnt sein"},
    {q:"She _____ meat, but now she's vegan. (eat + didn't use to)",choices:["didn't use to eat","usually didn't eat","wasn't used to eating"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ didn't use to eat - didn't + use to (ohne -d) | âœ— usually didn't eat - usually fÃ¼r Gegenwart | âœ— wasn't used to eating - falsch: be used to = gewÃ¶hnt sein"},
    {q:"_____ you _____ video games a lot when you were ten? (play + did ... use to)",choices:["Did / use to play","Do / usually play","Were / used to playing"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ Did / use to play - Frage Vergangenheit â†’ Did + use to | âœ— Do / usually play - Do fÃ¼r Gegenwart | âœ— Were / used to playing - falsch: be used to = gewÃ¶hnt sein"},
    {q:"We _____ TV every evening before we had kids. (watch + used to)",choices:["used to watch","usually watched","were used to watching"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ used to watch - before we had kids â†’ used to fÃ¼r Vergangenheit | âœ— usually watched - usually fÃ¼r Gegenwart | âœ— were used to watching - falsch: be used to = gewÃ¶hnt sein"},
    {q:"I _____ early mornings; it's easy for me. (get up + be used to)",choices:["am used to getting up","used to get up","usually get up"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ am used to getting up - it's easy for me = gewÃ¶hnt an â†’ be used to + -ing | âœ— used to get up - falsch: used to fÃ¼r Vergangenheit | âœ— usually get up - usually fÃ¼r Gewohnheiten, nicht GewÃ¶hnung"},
    {q:"He _____ long emails at work. (write + be used to)",choices:["is used to writing","used to write","usually writes"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ is used to writing - gewÃ¶hnt an etwas â†’ be used to + -ing | âœ— used to write - falsch: used to fÃ¼r Vergangenheit | âœ— usually writes - usually fÃ¼r Gewohnheiten, nicht GewÃ¶hnung"},
    {q:"Are you _____ spicy food? (eat + be used to)",choices:["used to eating","use to eat","usually eating"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ used to eating - Are you used to = gewÃ¶hnt an? â†’ be used to + -ing | âœ— use to eat - falsch: use to nur nach didn't | âœ— usually eating - falsch: usually nicht nach are you"},
    {q:"She _____ in English at meetings now. (speak + be used to)",choices:["is used to speaking","used to speak","usually speaks"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ is used to speaking - now = gewÃ¶hnt an â†’ be used to + -ing | âœ— used to speak - falsch: used to fÃ¼r Vergangenheit | âœ— usually speaks - usually fÃ¼r Gewohnheiten, nicht GewÃ¶hnung"},
    {q:"They _____ on the motorway. (drive + be used to)",choices:["are used to driving","used to drive","usually drive"],a:0,tenses:["usuallyUsedTo"],exp:"âœ“ are used to driving - gewÃ¶hnt an â†’ be used to + -ing | âœ— used to drive - falsch: used to fÃ¼r Vergangenheit | âœ— usually drive - usually fÃ¼r Gewohnheiten, nicht GewÃ¶hnung"},    // WORKSHEET 1 - custom exercises 1-35
    ,
    {q:"She usually _ to work by bus. (go)",choices:["goes"],a:0,tenses:["worksheet1"],exp:""},
    {q:"Look! The children _ in the garden right now. (play)",choices:["are playing"],a:0,tenses:["worksheet1"],exp:""},
    {q:"I _ my keys every morning. (forget)",choices:["forget"],a:0,tenses:["worksheet1"],exp:""},
    {q:"He can't talk now, he _ a shower. (have)",choices:["is having"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We _ dinner at 7 p.m. every day. (eat)",choices:["eat"],a:0,tenses:["worksheet1"],exp:""},

    {q:"While I _ TV, the phone rang. (watch)",choices:["was watching"],a:0,tenses:["worksheet1"],exp:""},
    {q:"Yesterday we _ a great film at the cinema. (see)",choices:["saw"],a:0,tenses:["worksheet1"],exp:""},
    {q:"They _ football when it started to rain. (play)",choices:["were playing"],a:0,tenses:["worksheet1"],exp:""},
    {q:"I _ home when I met my old teacher. (walk)",choices:["was walking"],a:0,tenses:["worksheet1"],exp:""},
    {q:"She _ her leg when she was skiing. (break)",choices:["broke"],a:0,tenses:["worksheet1"],exp:""},

    {q:"I _ this film three times already. (see)",choices:["have seen"],a:0,tenses:["worksheet1"],exp:""},
    {q:"How long _ you _ English? (learn)",choices:["have been learning"],a:0,tenses:["worksheet1"],exp:""},
    {q:"He _ just _ his homework. (finish)",choices:["has just finished"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We _ in this city since 2010. (live)",choices:["have lived"],a:0,tenses:["worksheet1"],exp:""},
    {q:"She's tired because she _ all day. (work)",choices:["has been working"],a:0,tenses:["worksheet1"],exp:""},

    {q:"When we arrived, they _ already _. (leave)",choices:["had already left"],a:0,tenses:["worksheet1"],exp:""},
    {q:"I couldn't get in because I _ my keys at home. (forget)",choices:["had forgotten"],a:0,tenses:["worksheet1"],exp:""},
    {q:"By the time the lesson started, everyone _. (sit down)",choices:["had sat down"],a:0,tenses:["worksheet1"],exp:""},
    {q:"He was very tired because he _ all night. (study)",choices:["had been studying"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We didn't go to the cinema because we _ the film before. (see)",choices:["had seen"],a:0,tenses:["worksheet1"],exp:""},

    {q:"Look at those clouds! It _ soon. (be going to / rain)",choices:["is going to rain"],a:0,tenses:["worksheet1"],exp:""},
    {q:"Don't worry, I _ you with your homework. (will / help)",choices:["will help"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We _ at the café at 6 p.m. (meet)",choices:["are meeting"],a:0,tenses:["worksheet1"],exp:""},
    {q:"She _ medicine at university next year. (study)",choices:["is going to study"],a:0,tenses:["worksheet1"],exp:""},
    {q:"They _ probably win the match. (will)",choices:["will"],a:0,tenses:["worksheet1"],exp:""},

    {q:"When I was a child, I _ to the park every day. (used to / go)",choices:["used to go"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We _ spend our holidays in Italy, but now we go to Spain. (used to)",choices:["used to"],a:0,tenses:["worksheet1"],exp:""},
    {q:"He _ drink coffee, but now he prefers tea. (usually)",choices:["usually drinks"],a:0,tenses:["worksheet1"],exp:""},
    {q:"My sister _ late on Fridays. (usually / work)",choices:["usually works"],a:0,tenses:["worksheet1"],exp:""},
    {q:"Did you _ play football at school? (use to)",choices:["use to"],a:0,tenses:["worksheet1"],exp:""},

    {q:"He _ already _ lunch when I arrived. (have)",choices:["had already had"],a:0,tenses:["worksheet1"],exp:""},
    {q:"What _ you _ tomorrow evening? (do)",choices:["are you doing"],a:0,tenses:["worksheet1"],exp:""},
    {q:"I _ my best friend for ten years. (know)",choices:["have known"],a:0,tenses:["worksheet1"],exp:""},
    {q:"When I called, she _ dinner. (cook)",choices:["was cooking"],a:0,tenses:["worksheet1"],exp:""},
    {q:"By the time we got home, it _. (get / dark)",choices:["had got dark"],a:0,tenses:["worksheet1"],exp:""},

    // WORKSHEET 2 - 100 mixed exercises (exactly as authored)
    // Present Perfect (1-10)
    {q:"I _ never _ sushi before. (eat)",choices:["have never eaten"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ already _ her homework. (finish)",choices:["has already finished"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ just _ a new car. (buy)",choices:["have just bought"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ ever _ to Italy? (be)",choices:["has ever been"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ just _ the train. (catch)",choices:["have just caught"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ already _ that film twice. (see)",choices:["have already seen"],a:0,tenses:["worksheet2"],exp:""},
    {q:"My sister _ never _ a plane. (fly)",choices:["has never flown"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ not _ him since Monday. (see)",choices:["have not seen"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ just _ a coffee. (make)",choices:["has just made"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ never _ to London. (be)",choices:["has never been"],a:0,tenses:["worksheet2"],exp:""},

    // Past Simple (11-20)
    {q:"I _ a pizza yesterday. (eat)",choices:["ate"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ to school by bus last week. (go)",choices:["went"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ her phone yesterday. (lose)",choices:["lost"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ a party on Friday. (have)",choices:["had"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ his keys at home. (forget)",choices:["forgot"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ tennis with my friends on Sunday. (play)",choices:["played"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ to Paris last summer. (travel)",choices:["travelled"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ at 7 oclock this morning. (wake up)",choices:["woke up"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ our homework after dinner. (do)",choices:["did"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ his bike to school. (ride)",choices:["rode"],a:0,tenses:["worksheet2"],exp:""},

    // Past Continuous (21-30)
    {q:"I _ TV when the phone rang. (watch)",choices:["was watching"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ football when it started to rain. (play)",choices:["were playing"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ dinner when I arrived. (cook)",choices:["was cooking"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ a film when the lights went out. (watch)",choices:["were watching"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ to music while reading. (listen)",choices:["was listening"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ in the park when it began to snow. (walk)",choices:["were walking"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ home when I saw an accident. (drive)",choices:["was driving"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ a book while her sister was playing. (read)",choices:["was reading"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ for the bus when it started to rain. (wait)",choices:["were waiting"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ a shower when someone knocked on the door. (take)",choices:["was taking"],a:0,tenses:["worksheet2"],exp:""},

    // Past Perfect (31-40)
    {q:"She _ already _ lunch when I arrived. (have)",choices:["had already had"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ never _ sushi before that night. (try)",choices:["had never tried"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ already _ my homework before dinner. (finish)",choices:["had already finished"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ never _ the film before yesterday. (see)",choices:["had never seen"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ just _ the bus when it started to rain. (catch)",choices:["had just caught"],a:0,tenses:["worksheet2"],exp:""},
    {q:"My parents _ already _ to bed when I came home. (go)",choices:["had already gone"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ never _ a train before. (take)",choices:["had never taken"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ already _ him when you called. (meet)",choices:["had already met"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ already _ the tickets when I arrived. (buy)",choices:["had already bought"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ never _ the answer before. (know)",choices:["had never known"],a:0,tenses:["worksheet2"],exp:""},

    // Future (41-50)
    {q:"Look at those clouds! It _ soon. (be going to / rain)",choices:["is going to rain"],a:0,tenses:["worksheet2"],exp:""},
    {q:"Don't worry, I _ you tomorrow. (help)",choices:["will help"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ to London next week. (travel)",choices:["is travelling"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ at 7 tomorrow morning. (leave)",choices:["are leaving"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I think they _ win the game. (will)",choices:["will"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ dinner tonight. (make)",choices:["is going to make"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ probably _ late. (be)",choices:["will probably be"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ football on Saturday. (play)",choices:["are playing"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ you at the station at 8. (meet)",choices:["will meet"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ never _ this problem again. (have)",choices:["will never have"],a:0,tenses:["worksheet2"],exp:""},

    // Used to (51-60)
    {q:"I _ to school by bike when I was younger. (use to / go)",choices:["used to go"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ a dog, but it died last year. (use to / have)",choices:["used to have"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ in this street. (use to / live)",choices:["used to live"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ every day, but now he doesnt. (use to / smoke)",choices:["used to smoke"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ every Sunday. (use to / visit)",choices:["used to visit"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ football at school. (use to / play)",choices:["used to play"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ long hair when she was a child. (use to / have)",choices:["used to have"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ in that house. (use to / live)",choices:["used to live"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ at the gym, but now he doesnt. (use to / train)",choices:["used to train"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ every summer. (use to / camp)",choices:["used to camp"],a:0,tenses:["worksheet2"],exp:""},

    // Usually (61-70)
    {q:"I _ coffee in the morning. (usually / drink)",choices:["usually drink"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ to school by bus. (usually / go)",choices:["usually goes"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ TV after dinner. (usually / watch)",choices:["usually watch"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ his homework before bed. (usually / do)",choices:["usually does"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ in the park on Sundays. (usually / walk)",choices:["usually walk"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ to bed early. (usually / go)",choices:["usually go"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ her bike to school. (usually / ride)",choices:["usually rides"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ pizza on Fridays. (usually / eat)",choices:["usually eat"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ his friends on weekends. (usually / meet)",choices:["usually meets"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ homework in the evening. (usually / do)",choices:["usually do"],a:0,tenses:["worksheet2"],exp:""},

    // Mix (71-80)
    {q:"I _ a book yesterday. (read)",choices:["read"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ never _ him before. (meet)",choices:["has never met"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ football when it started to rain. (play)",choices:["were playing"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ already _ dinner when I came home. (eat)",choices:["had already eaten"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ to Paris last year. (fly)",choices:["flew"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ at 7 oclock this morning. (wake up)",choices:["woke up"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ just _ me a message. (send)",choices:["has just sent"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ homework after school. (do)",choices:["do"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ never _ sushi before. (try)",choices:["has never tried"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ TV when the lights went out. (watch)",choices:["were watching"],a:0,tenses:["worksheet2"],exp:""},

    // More mix (81-90)
    {q:"I _ just _ him today. (see)",choices:["have just seen"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ never _ in a plane. (be)",choices:["has never been"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ already _ the tickets. (buy)",choices:["have already bought"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ football last weekend. (play)",choices:["played"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ never _ to Italy before. (go)",choices:["have never been"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ already _ lunch. (have)",choices:["have already had"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ to school yesterday. (walk)",choices:["walked"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ TV when the phone rang. (watch)",choices:["were watching"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ always _ coffee in the morning. (drink)",choices:["always drinks"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ a pizza yesterday. (order)",choices:["ordered"],a:0,tenses:["worksheet2"],exp:""},

    // Final 10 (91-100)
    {q:"I _ usually _ my bike to school. (ride)",choices:["usually ride"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ usually _ early. (get up)",choices:["usually gets up"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ used to _ every Sunday. (meet)",choices:["used to meet"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ already _ the test. (finish)",choices:["has already finished"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ to London last year. (travel)",choices:["travelled"],a:0,tenses:["worksheet2"],exp:""},
    {q:"I _ never _ in America. (be)",choices:["have never been"],a:0,tenses:["worksheet2"],exp:""},
    {q:"She _ usually _ her room on Saturdays. (clean)",choices:["usually cleans"],a:0,tenses:["worksheet2"],exp:""},
    {q:"We _ never _ sushi before. (try)",choices:["have never tried"],a:0,tenses:["worksheet2"],exp:""},
    {q:"He _ already _ his homework. (do)",choices:["has already done"],a:0,tenses:["worksheet2"],exp:""},
    {q:"They _ to music when I called. (listen)",choices:["were listening"],a:0,tenses:["worksheet2"],exp:""}
  ];

  // Filter-Gruppen / Chips
  const TENSE_LABELS={
    presentSimple:"Present Simple",
    presentCont:"Present Continuous", 
    mixed:"Mixed Present",
    pastSimple:"Past Simple",
    pastCont:"Past Continuous",
    presentPerf:"Present Perfect",
    presentPerfCont:"Present Perfect Continuous",
    pastPerf:"Past Perfect",
    pastPerfCont:"Past Perfect Continuous",
    futureWill:"Future (will)",
    futureGoingTo:"Future (going to)",
    futureArrangement:"Future Arrangements",
    futureSchedule:"Future Schedule",
    modals:"Modals",
    usedTo:"Used to / Be used to / Would",
    questions:"Questions & Negations",
    conditionals:"Conditionals & Wishes",
    passiveVoice:"Passive Voice",
    reportedSpeech:"Reported Speech & Verb Patterns",
    usuallyUsedTo:"Usually & Used to",
    worksheet1:"Worksheet 1",
    worksheet2:"Worksheet 2"
  };
  const MODES=[
    {id:'learn',label:'Learn'},
    {id:'practice',label:'Practice'},
    {id:'test',label:'Test'},
    {id:'blind',label:'Blind'},
    {id:'write',label:'Write'}    // WORKSHEET 1 - custom exercises 1-35
    ,
    {q:"She usually _ to work by bus. (go)",choices:["goes"],a:0,tenses:["worksheet1"],exp:""},
    {q:"Look! The children _ in the garden right now. (play)",choices:["are playing"],a:0,tenses:["worksheet1"],exp:""},
    {q:"I _ my keys every morning. (forget)",choices:["forget"],a:0,tenses:["worksheet1"],exp:""},
    {q:"He can't talk now, he _ a shower. (have)",choices:["is having"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We _ dinner at 7 p.m. every day. (eat)",choices:["eat"],a:0,tenses:["worksheet1"],exp:""},

    {q:"While I _ TV, the phone rang. (watch)",choices:["was watching"],a:0,tenses:["worksheet1"],exp:""},
    {q:"Yesterday we _ a great film at the cinema. (see)",choices:["saw"],a:0,tenses:["worksheet1"],exp:""},
    {q:"They _ football when it started to rain. (play)",choices:["were playing"],a:0,tenses:["worksheet1"],exp:""},
    {q:"I _ home when I met my old teacher. (walk)",choices:["was walking"],a:0,tenses:["worksheet1"],exp:""},
    {q:"She _ her leg when she was skiing. (break)",choices:["broke"],a:0,tenses:["worksheet1"],exp:""},

    {q:"I _ this film three times already. (see)",choices:["have seen"],a:0,tenses:["worksheet1"],exp:""},
    {q:"How long _ you _ English? (learn)",choices:["have been learning"],a:0,tenses:["worksheet1"],exp:""},
    {q:"He _ just _ his homework. (finish)",choices:["has just finished"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We _ in this city since 2010. (live)",choices:["have lived"],a:0,tenses:["worksheet1"],exp:""},
    {q:"She's tired because she _ all day. (work)",choices:["has been working"],a:0,tenses:["worksheet1"],exp:""},

    {q:"When we arrived, they _ already _. (leave)",choices:["had already left"],a:0,tenses:["worksheet1"],exp:""},
    {q:"I couldn't get in because I _ my keys at home. (forget)",choices:["had forgotten"],a:0,tenses:["worksheet1"],exp:""},
    {q:"By the time the lesson started, everyone _. (sit down)",choices:["had sat down"],a:0,tenses:["worksheet1"],exp:""},
    {q:"He was very tired because he _ all night. (study)",choices:["had been studying"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We didn't go to the cinema because we _ the film before. (see)",choices:["had seen"],a:0,tenses:["worksheet1"],exp:""},

    {q:"Look at those clouds! It _ soon. (be going to / rain)",choices:["is going to rain"],a:0,tenses:["worksheet1"],exp:""},
    {q:"Don't worry, I _ you with your homework. (will / help)",choices:["will help"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We _ at the café at 6 p.m. (meet)",choices:["are meeting"],a:0,tenses:["worksheet1"],exp:""},
    {q:"She _ medicine at university next year. (study)",choices:["is going to study"],a:0,tenses:["worksheet1"],exp:""},
    {q:"They _ probably win the match. (will)",choices:["will"],a:0,tenses:["worksheet1"],exp:""},

    {q:"When I was a child, I _ to the park every day. (used to / go)",choices:["used to go"],a:0,tenses:["worksheet1"],exp:""},
    {q:"We _ spend our holidays in Italy, but now we go to Spain. (used to)",choices:["used to"],a:0,tenses:["worksheet1"],exp:""},
    {q:"He _ drink coffee, but now he prefers tea. (usually)",choices:["usually drinks"],a:0,tenses:["worksheet1"],exp:""},
    {q:"My sister _ late on Fridays. (usually / work)",choices:["usually works"],a:0,tenses:["worksheet1"],exp:""},
    {q:"Did you _ play football at school? (use to)",choices:["use to"],a:0,tenses:["worksheet1"],exp:""},

    {q:"He _ already _ lunch when I arrived. (have)",choices:["had already had"],a:0,tenses:["worksheet1"],exp:""},
    {q:"What _ you _ tomorrow evening? (do)",choices:["are you doing"],a:0,tenses:["worksheet1"],exp:""},
    {q:"I _ my best friend for ten years. (know)",choices:["have known"],a:0,tenses:["worksheet1"],exp:""},
    {q:"When I called, she _ dinner. (cook)",choices:["was cooking"],a:0,tenses:["worksheet1"],exp:""},
    {q:"By the time we got home, it _. (get / dark)",choices:["had got dark"],a:0,tenses:["worksheet1"],exp:""}
  ];
  function sanitizeParenHints(str, tenses, blanksCount, answer){
    function lemmaToken(tok){
      if(!tok) return '';
      let t=tok.toLowerCase().replace(/[^a-z']/g,'');
      const CONTRA={
        "won't":"will","can't":"can","shan't":"shall","wouldn't":"would","shouldn't":"should","couldn't":"could","didn't":"did","doesn't":"does","don't":"do","isn't":"is","aren't":"are","wasn't":"was","weren't":"were","hasn't":"has","haven't":"have","hadn't":"had"
      };
      if(CONTRA[t]) t=CONTRA[t];
      const IRR={
        'am':'be','is':'be','are':'be','was':'be','were':'be','been':'be','being':'be',
        'has':'have','had':'have',
        'did':'do','does':'do',
        'went':'go','gone':'go',
        'met':'meet','made':'make','gave':'give','given':'give','took':'take','taken':'take',
        'saw':'see','seen':'see','wrote':'write','written':'write','spoke':'speak','spoken':'speak',
        'ate':'eat','eaten':'eat','drank':'drink','drunk':'drink','bought':'buy','brought':'bring',
        'slept':'sleep','kept':'keep','left':'leave','felt':'feel','found':'find','heard':'hear','got':'get','gotten':'get',
        'taught':'teach','caught':'catch','sat':'sit','sat':'sit','ran':'run','came':'come','become':'become','became':'become',
        'lost':'lose','paid':'pay','spent':'spend','threw':'throw','thrown':'throw','put':'put','cut':'cut','let':'let','read':'read'
      };
      if(IRR[t]) return IRR[t];
      // drop adverbs/particles and pronouns/determiners
      const DROP=new Set(['not','to','just','already','yet','still','usually','often','always','sometimes','never',
        'he','she','it','we','you','they','i','me','him','her','us','them','one','ones',
        'this','that','these','those','there','here','who','whom','whose','which','what','where','when','why','how']);
      if(DROP.has(t)) return '';
      // modals stay as-is
      const MODALS=new Set(['will','would','can','could','may','might','must','shall','should']);
      if(MODALS.has(t)) return t;
      // strip common suffixes
      if(/ing$/.test(t)){
        if(/ying$/.test(t)) return t.replace(/ying$/,'y');
        let base=t.replace(/ing$/,'');
        if(/v$/.test(base)) base=base+'e';
        return base;
      }
      if(/ied$/.test(t)) return t.replace(/ied$/,'y');
      if(/ed$/.test(t)){
        let base=t.replace(/ed$/,'');
        if(/v$/.test(base)) base=base+'e';
        else if(/(?<!s)s$/.test(base) && !/ss$/.test(base)) base=base+'e';
        return base;
      }
      if(/es$/.test(t)) return t.replace(/es$/,'');
      if(/s$/.test(t) && t!=='is') return t.replace(/s$/,'');
      return t;
    }
    function deriveFromAnswer(ans){
      if(!ans) return [];
      const perBlank=ans.split('/').map(s=>s.trim());
      const out=[];
      perBlank.forEach(part=>{
        const toks=part.split(/\s+/).filter(Boolean);
        for(let i=0;i<toks.length;i++){
          let tok=toks[i].toLowerCase();
          // handle "used to" phrase → use
          if((tok==='used' || tok==='use') && (i+1)<toks.length && toks[i+1].toLowerCase()==='to'){
            out.push('use'); i++; continue;
          }
          const le=lemmaToken(tok);
          if(le) out.push(le);
        }
      });
      // de-duplicate consecutive duplicates, keep order
      const final=[]; const seen=new Set();
      out.forEach(v=>{ const key=v; if(!seen.has(key)){ final.push(v); seen.add(key);} });
      return final;
    }
    const stripGrammar = (s) => {
      let t = (s||'').replace(/\s+/g,' ').trim();
      // remove leading markers
      t = t.replace(/^(?:to|not)\s+/i,'');
      // remove auxiliaries if they appear alone (we will infer needed ones like 'have' separately)
      if (/^(am|is|are|was|were|be|been|being|do|does|did|have|has|had)$/i.test(t)) return '';
      // remove used to / use to / be used to
      if (/\bused?\s+to\b/i.test(t)) return '';
      // remove going to / be going to
      if (/\bgoing\s+to\b/i.test(t)) return '';
      // general cleanup
      return t.trim();
    };

    const tset = new Set(Array.isArray(tenses)?tenses:[]);
    const isPerfect = ['presentPerf','presentPerfCont','pastPerf','pastPerfCont'].some(k=>tset.has(k));
    const needAuxHave = isPerfect && (blanksCount||0) >= 2;
    if(answer){
      const hintList=deriveFromAnswer(answer);
      const hintText = hintList.length? '('+hintList.join('/')+')' : '';
      if(/\([^)]*\)/.test(str)){
        return str.replace(/\(([^)]*)\)/g, hintText || '');
      } else {
        return hintText? (str.trim()+ ' ' + hintText) : str;
      }
    }
    return str.replace(/\(([^)]*)\)/g,(m,inner)=>{
      // split multi-gap hints: watch/ring
      const tokens = inner.split('/').map(t=>t.trim()).filter(Boolean);
      const cleaned = [];
      tokens.forEach(tok => {
        // split plus parts, evaluate candidates for base verb(s)
        const plusParts = tok.split('+').map(p=>p.trim()).filter(Boolean);
        const candidates = [];
        plusParts.forEach(p => {
          const c = stripGrammar(p);
          if (c) candidates.push(c);
        });
        // choose first surviving candidate as base
        let base = candidates.length ? candidates[0] : '';
        if (!base) {
          // if nothing usable remains (e.g., "past habit"), skip this token entirely
          return; // do not push anything for this token
        }
        cleaned.push(base);
      });
      // If it's a perfect tense with 2 blanks and only one token present, prepend base auxiliary 'have'
      if (needAuxHave && cleaned.length===1 && cleaned[0].toLowerCase()!=='have'){
        cleaned.unshift('have');
      }
      if (cleaned.length===0) return '';
      return '(' + cleaned.join('/') + ')';
    });
  }
  // DOM helpers (restored)
  const $=s=>document.querySelector(s);
  const $$=s=>Array.from(document.querySelectorAll(s));
  const state={mode:'write',selectedTenses:new Set(Object.keys(TENSE_LABELS)),pool:[],idx:0,score:0,locked:false,current:null,choiceOrder:[]};

  // Modus-Chips
  const modeChips=$('#modeChips');
  MODES.forEach(m=>{const chip=document.createElement('div');chip.className='chip'+(m.id===state.mode?' active':'');chip.textContent=m.label;chip.addEventListener('click',()=>{state.mode=m.id;$$('#modeChips .chip').forEach(c=>c.classList.remove('active'));chip.classList.add('active');});modeChips.appendChild(chip);});

  // Zeitform-Chips
  const tenseChips=$('#tenseChips');
  Object.entries(TENSE_LABELS).forEach(([key,label])=>{const chip=document.createElement('div');chip.className='chip active';chip.textContent=label;chip.addEventListener('click',()=>{if(state.selectedTenses.has(key)){state.selectedTenses.delete(key);chip.classList.remove('active');}else{state.selectedTenses.add(key);chip.classList.add('active');}});tenseChips.appendChild(chip);});

  // Helper
  function maybeFixMojibake(str){
    if(!str) return str;
    if(!/[Ãâ�]/.test(str)) return str;
    try{
      const bytes=new Uint8Array(Array.from(str, c=>c.charCodeAt(0)&0xFF));
      const dec=new TextDecoder('utf-8').decode(bytes);
      return dec;
    }catch(_){return str;}
  }

  function expToHtml(exp, answer, isCorrect){
    const fixed=maybeFixMojibake(exp||'');
    const parts=fixed.split('|').map(s=>s.trim()).filter(Boolean);
    let items=parts.map(s=>{
      let type='';
      if(/^S\\s*/.test(s)) { type='good'; s=s.replace(/^S\\s*[-:]?\\s*/,''); }
      if(/^([✓✔V]\s*|(?:correct)\b)/i.test(s)) type='good';
      if(/^([✗✕xX\?]\s*|(?:falsch)\b)/i.test(s)) type= type || 'bad';
      s=s.replace(/^([✓✔✗✕V\?]+)\s*[-:]?\s*/,'');
      return {type:type||'bad', text:s};
    });
    if(!items.some(it=>it.type==='good') && items.length){
      items = items.map((it,idx)=>({type: idx===0?'good':'bad', text: it.text}));
    }
    const header=isCorrect?`Richtig: "${answer}"`:`Richtig wäre: "${answer}"`;
    const lis=items.map(it=>`<li class="${it.type}">${it.text}</li>`).join('');
    const cls=isCorrect?'ok':'err';
    return `<div class="explain-panel ${cls}"><div class="ex-header">${header}</div><ul class="ex-list">${lis}</ul></div>`;
  }

  function shuffle(a){return a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(v=>v[1]);}
  function buildPool(){let chosen=BANK.filter(q=>q.tenses.some(t=>state.selectedTenses.has(t)));state.pool=shuffle(chosen);state.idx=0;state.score=0;}

  function nextQuestion(){if(state.idx>=state.pool.length){return showResult();}
    const q=state.pool[state.idx]; state.current=q;
    // For any worksheet category, present the question exactly as authored; otherwise show sanitized hints
    const showExact = Array.isArray(q.tenses) && q.tenses.some(t=>/^worksheet/.test(t));
    $('#qText').textContent = showExact ? q.q : sanitizeParenHints(q.q, q.tenses, (q.q.match(/_{2,}/g)||[]).length, q.choices[q.a]);
    const box=$('#choices'); box.innerHTML='';
    if(state.mode==='write'){
      const input=document.createElement('input'); input.type='text'; input.id='writeInput'; input.placeholder='Antwort hier eingeben (groß/klein zählt)';
      input.addEventListener('keydown',(e)=>{
        if(e.key==='Enter'){
          if($('#checkBtn').classList.contains('hidden')){
            $('#nextBtn').click();
          } else {
            $('#checkBtn').click();
          }
        }
      });
      box.appendChild(input);
      $('#checkBtn').classList.remove('hidden'); $('#nextBtn').classList.add('hidden');
      input.focus();
    } else {
      const order=shuffle(q.choices.map((_,i)=>i));
      state.choiceOrder=order;
      order.forEach((origIdx,displayIdx)=>{
        const b=document.createElement('button');
        b.className='choice';
        b.textContent=q.choices[origIdx];
        b.addEventListener('click',()=>pick(displayIdx));
        box.appendChild(b);
      });
      $('#checkBtn').classList.add('hidden'); $('#nextBtn').classList.remove('hidden');
    }
    $('#progBar').style.width=(state.idx/state.pool.length*100)+"%"; $('#explain').textContent='';
  }

  function pick(i){ if(state.locked) return; state.locked=true; const q=state.current; const correct=(state.choiceOrder[i]===q.a);
    const buttons=$$('#choices .choice');
    buttons.forEach((b,j)=>{ if(state.choiceOrder[j]===q.a) b.classList.add('correct'); if(j===i && !correct) b.classList.add('wrong'); b.disabled=true; });
    if(correct) state.score++;
    if(state.mode==='learn' || (!correct && state.mode!=='blind')){
      const answer=q.choices[q.a];
      $('#explain').innerHTML=expToHtml(q.exp, answer, correct);
    }
  }

  function pickWrite(){ if(state.locked) return; state.locked=true; const q=state.current; const val=$('#writeInput').value.trim(); const answer=q.choices[q.a];
    if(val===answer){ state.score++; $('#explain').textContent='âœ… Richtig'; }
    else { $('#explain').textContent=`âŒ Falsch. Richtig wÃ¤re: "${answer}". ${q.exp}`; }
  }

  // Override write-mode check to show improved explanation panel
  pickWrite = function(){
    if(state.locked) return;
    state.locked=true;
    const q=state.current;
    const val=$('#writeInput').value.trim();
    const answer=q.choices[q.a];
    const correct=(val===answer);
    if(correct) state.score++;
    if(state.mode!=='blind'){
      $('#explain').innerHTML=expToHtml(q.exp, answer, correct);
    }
  }

  function showResult(){ $('#quiz').classList.add('hidden'); $('#result').classList.remove('hidden'); $('#finalScore').textContent=`${state.score}/${state.pool.length}`; }

  // Controls
  $('#startBtn').addEventListener('click',()=>{
    if(state.selectedTenses.size===0){ alert('Bitte wähle mindestens eine Kategorie'); return; }
    $('#startScreen').classList.add('hidden'); $('#quiz').classList.remove('hidden'); buildPool(); nextQuestion();
  });

  $('#nextBtn').addEventListener('click',()=>{ state.idx++; state.locked=false; if(state.idx>=state.pool.length) showResult(); else nextQuestion(); });
  $('#checkBtn').addEventListener('click',()=>{ pickWrite(); $('#checkBtn').classList.add('hidden'); $('#nextBtn').classList.remove('hidden'); });
  $('#retryBtn').addEventListener('click',()=>{ buildPool(); state.idx=0; state.locked=false; $('#result').classList.add('hidden'); $('#quiz').classList.remove('hidden'); nextQuestion(); });
  $('#homeBtn').addEventListener('click',()=>{ $('#result').classList.add('hidden'); $('#startScreen').classList.remove('hidden'); });
  </script>
</body>
</html>












