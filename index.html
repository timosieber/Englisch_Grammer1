<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>English Tenses Trainer</title>
  <style>
    :root{
      --bg:#0f172a;--text:#e5e7eb;--accent:#22d3ee;--accent2:#a78bfa;--good:#34d399;--bad:#f87171;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;display:flex;justify-content:center}
    .app{width:100%;max-width:820px;padding:16px 16px 80px}
    h1{font-size:24px;text-align:center;margin:20px 0}
    .card{background:rgba(255,255,255,.05);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:20px}
    button,input{appearance:none;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.08);color:var(--text);padding:14px 20px;border-radius:12px;font-weight:600;cursor:pointer}
    input{width:100%}
    .choice{display:block;width:100%;margin:6px 0}
    .choice.correct{border-color:var(--good);background:rgba(52,211,153,.14)}
    .choice.wrong{border-color:var(--bad);background:rgba(248,113,113,.14)}
    .progress{height:10px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden;margin:10px 0}
    .progress>div{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0}
    .hidden{display:none}
    .chips{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:10px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.1);font-size:14px;cursor:pointer}
    .chip.active{border-color:var(--accent);background:rgba(34,211,238,.25)}
    #explain{margin-top:10px;font-size:14px;color:#cbd5e1;text-align:center}
    .verb-hint{margin-top:10px;padding:8px 12px;background:rgba(34,211,238,.15);border:1px solid var(--accent);border-radius:8px;font-size:14px;text-align:center;color:var(--accent);font-weight:600}
  </style>
</head>
<body>
  <div class="app">
    <section class="card" id="startScreen">
      <h1>English Tenses Trainer</h1>
      <p style="text-align:center">Wähle Modus und Zeitformen. Fokus auf <b>to use</b> in allen Zeiten + Signalwörtern (usually / used to / have used).</p>

      <h3>Modus auswählen</h3>
      <div class="chips" id="modeChips"></div>
      <p style="font-size:12px;text-align:center">Learn = mit Erklärungen · Practice = schneller · Test = Ergebnis am Schluss · Blind = ohne Hinweise · Write = selbst schreiben (streng, inkl. Rechtschreibung)</p>

      <h3>Zeitformen / Kategorien auswählen</h3>
      <div class="chips" id="tenseChips"></div>

      <div class="row">
        <button id="startBtn">Start Training</button>
      </div>
    </section>

    <section class="card hidden" id="quiz">
      <div class="progress"><div id="progBar"></div></div>
      <h2 id="qText"></h2>
      <div id="choices"></div>
      <div id="explain"></div>
      <div class="row"><button id="checkBtn" class="hidden">Prüfen</button><button id="nextBtn">Weiter</button></div>
    </section>

    <section class="card hidden" id="result">
      <h2>Dein Ergebnis</h2>
      <p id="finalScore">0/0</p>
      <div class="row"><button id="retryBtn">Nochmal</button><button id="homeBtn">Home</button></div>
    </section>
  </div>

  <script>
  // ——————————————————————————————————————————————
  // FRAGEN-POOL (to use + Signalwörter) — alle wichtigen Zeitformen
  // tenses-Tags steuern Filter-Chips auf dem Startscreen
  // ——————————————————————————————————————————————
  const BANK=[
    // SIGNALWÖRTER (usually / used to / have used)
    {q:"My sister ___ her phone for homework. (use)",choices:["usually uses","used to use","has used"],a:0,tenses:["signals"],exp:"Gewohnheit jetzt → usually + Present Simple: usually uses."},
    {q:"When I was young, I ___ my dad's computer. (use)",choices:["used to use","usually use","have used"],a:0,tenses:["signals"],exp:"✓ used to use - When I was young → frühere Gewohnheit (jetzt nicht mehr) | ✗ usually use - falsch: usually für Gegenwart | ✗ have used - falsch: Present Perfect für Erfahrung, nicht Gewohnheit"},
    {q:"The students ___ this app many times before. (use)",choices:["have used","usually use","used to use"],a:0,tenses:["signals"],exp:"Erfahrung bis jetzt → Present Perfect: have used."},

    // PRESENT SIMPLE
    {q:"Tom ___ his phone every morning. (use)",choices:["uses","use","is using"],a:0,tenses:["presentSimple"],exp:"✓ uses - 3. Person Singular + every morning → Present Simple mit -s | ✗ use - falsch: 3. Person braucht -s | ✗ is using - falsch: every morning = Gewohnheit, nicht momentan"},
    {q:"We always ___ English apps in class. (use)",choices:["use","uses","are using"],a:0,tenses:["presentSimple"],exp:"We + always → Present Simple: use (base form)."},
    {q:"The teacher never ___ German words in English class. (use)",choices:["uses","use","is using"],a:0,tenses:["presentSimple"],exp:"3. Person + never → Present Simple: uses (-s ending)."},

    // PRESENT CONTINUOUS
    {q:"Look! She ___ her laptop right now. (use)",choices:["is using","uses","has used"],a:0,tenses:["presentCont"],exp:"✓ is using - Look! + right now → Present Continuous | ✗ uses - falsch: Present Simple passt nicht zu right now | ✗ has used - falsch: Present Perfect passt nicht zu momentaner Handlung"},
    {q:"We ___ the internet at the moment. (use)",choices:["are using","use","have used"],a:0,tenses:["presentCont"],exp:"at the moment → Present Continuous: are using."},
    {q:"Listen! The students ___ their tablets. (use)",choices:["are using","use","used"],a:0,tenses:["presentCont"],exp:"Listen! → Present Continuous: are using."},

    // PRESENT PERFECT SIMPLE
    {q:"I ___ this program since 2020. (use)",choices:["have used","had used","am using"],a:0,tenses:["presentPerf"],exp:"✓ have used - since 2020 → Present Perfect (Bezug zur Gegenwart) | ✗ had used - falsch: Past Perfect nur bei Vorvergangenheit | ✗ am using - falsch: Present Continuous nicht mit since"},
    {q:"She ___ her computer for three hours today. (use)",choices:["has used","have used","is using"],a:0,tenses:["presentPerf"],exp:"today + 3. Person → Present Perfect: has used."},
    {q:"The class ___ this website before. (use)",choices:["has used","have used","used"],a:0,tenses:["presentPerf"],exp:"before → Present Perfect: has used."},

    // PRESENT PERFECT CONTINUOUS
    {q:"They ___ this app for two months now. (use)",choices:["have been using","had been using","are using"],a:0,tenses:["presentPerfCont"],exp:"for + Zeitraum + now → Present Perfect Continuous."},
    {q:"I ___ my tablet all morning. (use)",choices:["have been using","had been using","am using"],a:0,tenses:["presentPerfCont"],exp:"all morning → Present Perfect Continuous."},

    // PAST SIMPLE
    {q:"Yesterday morning I ___ the wrong app. (use)",choices:["used","was using","have used"],a:0,tenses:["pastSimple"],exp:"Yesterday → Past Simple: used."},
    {q:"Last week we ___ a new program in IT class. (use)",choices:["used","were using","have used"],a:0,tenses:["pastSimple"],exp:"Last week → Past Simple: used."},
    {q:"Two years ago, students ___ different books. (use)",choices:["used","were using","have used"],a:0,tenses:["pastSimple"],exp:"Two years ago → Past Simple: used."},

    // PAST CONTINUOUS
    {q:"At 10 am yesterday, I ___ my computer. (use)",choices:["was using","used","am using"],a:0,tenses:["pastCont"],exp:"Zeitpunkt gestern → Past Continuous: was using."},
    {q:"While she was studying, her brother ___ the TV. (use)",choices:["was using","used","uses"],a:0,tenses:["pastCont"],exp:"While + Past Continuous → was using."},
    {q:"During the lesson, we ___ our tablets. (use)",choices:["were using","used","are using"],a:0,tenses:["pastCont"],exp:"During → Past Continuous: were using."},

    // PAST PERFECT
    {q:"Before the test started, I ___ my calculator. (use)",choices:["had used","have used","used"],a:0,tenses:["pastPerf"],exp:"Before + Past → Past Perfect: had used."},
    {q:"She ___ the app before it became popular. (use)",choices:["had used","has used","used"],a:0,tenses:["pastPerf"],exp:"Vorvergangenheit → Past Perfect: had used."},

    // PAST PERFECT CONTINUOUS
    {q:"He ___ the program for hours before it crashed. (use)",choices:["had been using","has been using","was using"],a:0,tenses:["pastPerfCont"],exp:"Dauer vor Vergangenheit → Past Perfect Continuous."},
    {q:"We ___ the wifi for 20 minutes before it stopped working. (use)",choices:["had been using","have been using","were using"],a:0,tenses:["pastPerfCont"],exp:"Zeitdauer + before → Past Perfect Continuous."},

    // WILL-FUTURE
    {q:"I think I ___ my phone tomorrow. (use)",choices:["will use","am going to use","use"],a:0,tenses:["futureWill"],exp:"✓ will use - I think → spontane Meinung/Vermutung | ✗ am going to use - falsch: going to für feste Pläne | ✗ use - falsch: Present Simple nicht für Zukunft mit tomorrow"},
    {q:"The weather is bad. We ___ the indoor sports hall. (use)",choices:["will use","are going to use","use"],a:0,tenses:["futureWill"],exp:"spontane Entscheidung → will use."},
    {q:"Maybe she ___ a different app next time. (use)",choices:["will use","is going to use","uses"],a:0,tenses:["futureWill"],exp:"Maybe → Vermutung → will use."},

    // GOING-TO-FUTURE
    {q:"Look at those clouds! We ___ our umbrellas today. (use)",choices:["are going to use","will use","use"],a:0,tenses:["futureGoingTo"],exp:"sichtbare Anzeichen → going to + base: are going to use."},
    {q:"Next week we ___ new computers in the lab. (use)",choices:["are going to use","will use","use"],a:0,tenses:["futureGoingTo"],exp:"✓ are going to use - Next week → fester Plan/Vorhaben | ✗ will use - falsch: will für spontane Entscheidungen | ✗ use - falsch: Present Simple nicht für zukünftige Pläne"},
    {q:"I ___ this method for my presentation tomorrow. (use)",choices:["am going to use","will use","use"],a:0,tenses:["futureGoingTo"],exp:"fester Plan → going to use."},

    // FUTURE CONTINUOUS
    {q:"At 2 pm tomorrow, students ___ the computers. (use)",choices:["will be using","will use","are using"],a:0,tenses:["futureCont"],exp:"Zeitpunkt in der Zukunft → Future Continuous."},
    {q:"This time next week, we ___ the new software. (use)",choices:["will be using","will use","are going to use"],a:0,tenses:["futureCont"],exp:"this time next week → Future Continuous."},

    // FUTURE PERFECT
    {q:"By next Friday, I ___ this app for one month. (use)",choices:["will have used","will use","will be using"],a:0,tenses:["futurePerf"],exp:"By + Zeitpunkt → Future Perfect: will have used."},
    {q:"By the end of the year, students ___ many different programs. (use)",choices:["will have used","will use","will be using"],a:0,tenses:["futurePerf"],exp:"By the end → Future Perfect: will have used."},

    // FUTURE PERFECT CONTINUOUS
    {q:"By 5 pm today, I ___ my laptop for 8 hours. (use)",choices:["will have been using","will be using","will have used"],a:0,tenses:["futurePerfCont"],exp:"By + Dauer → Future Perfect Continuous."},

    // CONDITIONAL
    {q:"If I had more money, I ___ a better computer. (use)",choices:["would use","will use","am using"],a:0,tenses:["cond"],exp:"If I had → 2nd Conditional: would use."},
    {q:"If the internet was faster, we ___ more online tools. (use)",choices:["would use","will use","are using"],a:0,tenses:["cond"],exp:"If + was → 2nd Conditional: would use."},

    // CONDITIONAL CONTINUOUS  
    {q:"If I were rich, I ___ my phone all day. (use)",choices:["would be using","would use","will be using"],a:0,tenses:["condCont"],exp:"If I were → andauernde Hypothese: would be using."},

    // CONDITIONAL PERFECT
    {q:"If I had known about this app, I ___ it last year. (use)",choices:["would have used","had used","would use"],a:0,tenses:["condPerf"],exp:"If I had known → 3rd Conditional: would have used."},

    // CONDITIONAL PERFECT CONTINUOUS  
    {q:"If the wifi hadn't been broken, we ___ it all morning. (use)",choices:["would have been using","would be using","will have been using"],a:0,tenses:["condPerfCont"],exp:"If + hadn't been → dauerhafte irreale Vergangenheit."},
  ];

  // Filter-Gruppen / Chips
  const TENSE_LABELS={
    signals:"Signalwörter (usually / used to / have used)",
    presentSimple:"Present Simple",
    presentCont:"Present Continuous",
    presentPerf:"Present Perfect",
    presentPerfCont:"Present Perfect Continuous",
    pastSimple:"Past Simple",
    pastCont:"Past Continuous",
    pastPerf:"Past Perfect",
    pastPerfCont:"Past Perfect Continuous",
    futureWill:"Future (will)",
    futureGoingTo:"Future (going to)",
    futureCont:"Future Continuous",
    futurePerf:"Future Perfect",
    futurePerfCont:"Future Perfect Continuous",
    cond:"Conditional",
    condCont:"Conditional Continuous",
    condPerf:"Conditional Perfect",
    condPerfCont:"Conditional Perfect Continuous"
  };

  const MODES=[
    {id:'learn',label:'Learn'},
    {id:'practice',label:'Practice'},
    {id:'test',label:'Test'},
    {id:'blind',label:'Blind'},
    {id:'write',label:'Write'}
  ];

  const $=s=>document.querySelector(s);const $$=s=>Array.from(document.querySelectorAll(s));
  const state={mode:'learn',selectedTenses:new Set(Object.keys(TENSE_LABELS)),pool:[],idx:0,score:0,locked:false,current:null,choiceOrder:[]};

  // Modus-Chips
  const modeChips=$('#modeChips');
  MODES.forEach(m=>{const chip=document.createElement('div');chip.className='chip'+(m.id===state.mode?' active':'');chip.textContent=m.label;chip.addEventListener('click',()=>{state.mode=m.id;$$('#modeChips .chip').forEach(c=>c.classList.remove('active'));chip.classList.add('active');});modeChips.appendChild(chip);});

  // Zeitform-Chips
  const tenseChips=$('#tenseChips');
  Object.entries(TENSE_LABELS).forEach(([key,label])=>{const chip=document.createElement('div');chip.className='chip active';chip.textContent=label;chip.addEventListener('click',()=>{if(state.selectedTenses.has(key)){state.selectedTenses.delete(key);chip.classList.remove('active');}else{state.selectedTenses.add(key);chip.classList.add('active');}});tenseChips.appendChild(chip);});

  // Helper
  function shuffle(a){return a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(v=>v[1]);}
  function buildPool(){let chosen=BANK.filter(q=>q.tenses.some(t=>state.selectedTenses.has(t)));state.pool=shuffle(chosen);state.idx=0;state.score=0;}

  function nextQuestion(){if(state.idx>=state.pool.length){return showResult();}
    const q=state.pool[state.idx]; state.current=q;
    $('#qText').textContent=q.q; const box=$('#choices'); box.innerHTML='';
    if(state.mode==='write'){
      const input=document.createElement('input'); input.type='text'; input.id='writeInput'; input.placeholder='Antwort hier eingeben (groß/klein zählt)'; 
      input.addEventListener('keydown',(e)=>{
        if(e.key==='Enter'){
          if($('#checkBtn').classList.contains('hidden')){
            // Wenn Check-Button versteckt ist, zur nächsten Frage
            $('#nextBtn').click();
          } else {
            // Wenn Check-Button sichtbar ist, prüfen
            $('#checkBtn').click();
          }
        }
      });
      box.appendChild(input);
      $('#checkBtn').classList.remove('hidden'); $('#nextBtn').classList.add('hidden');
      input.focus();
    } else {
      // Shuffle choices per question and remember the display order
      const order=shuffle(q.choices.map((_,i)=>i));
      state.choiceOrder=order;
      order.forEach((origIdx,displayIdx)=>{
        const b=document.createElement('button');
        b.className='choice';
        b.textContent=q.choices[origIdx];
        b.addEventListener('click',()=>pick(displayIdx));
        box.appendChild(b);
      });
      $('#checkBtn').classList.add('hidden'); $('#nextBtn').classList.remove('hidden');
    }
    $('#progBar').style.width=(state.idx/state.pool.length*100)+"%"; $('#explain').textContent='';
  }

  function pick(i){ if(state.locked) return; state.locked=true; const q=state.current; const correct=(state.choiceOrder[i]===q.a);
    const buttons=$$('#choices .choice');
    buttons.forEach((b,j)=>{ if(state.choiceOrder[j]===q.a) b.classList.add('correct'); if(j===i && !correct) b.classList.add('wrong'); b.disabled=true; });
    if(correct) state.score++;
    if(state.mode==='learn' || (!correct && state.mode!=='blind')){ $('#explain').textContent=q.exp; }
  }

  function pickWrite(){ if(state.locked) return; state.locked=true; const q=state.current; const val=$('#writeInput').value.trim(); const answer=q.choices[q.a];
    if(val===answer){ state.score++; $('#explain').textContent='✅ Richtig'; }
    else { $('#explain').textContent=`❌ Falsch. Richtig wäre: "${answer}". ${q.exp}`; }
  }

  function showResult(){ $('#quiz').classList.add('hidden'); $('#result').classList.remove('hidden'); $('#finalScore').textContent=`${state.score}/${state.pool.length}`; }

  // Controls
  $('#startBtn').addEventListener('click',()=>{
    if(state.selectedTenses.size===0){ alert('Bitte wähle mindestens eine Zeitform/Kategorie'); return; }
    $('#startScreen').classList.add('hidden'); $('#quiz').classList.remove('hidden'); buildPool(); nextQuestion();
  });

  $('#nextBtn').addEventListener('click',()=>{ state.idx++; state.locked=false; if(state.idx>=state.pool.length) showResult(); else nextQuestion(); });
  $('#checkBtn').addEventListener('click',()=>{ pickWrite(); $('#checkBtn').classList.add('hidden'); $('#nextBtn').classList.remove('hidden'); });
  $('#retryBtn').addEventListener('click',()=>{ buildPool(); state.idx=0; state.locked=false; $('#result').classList.add('hidden'); $('#quiz').classList.remove('hidden'); nextQuestion(); });
  $('#homeBtn').addEventListener('click',()=>{ $('#result').classList.add('hidden'); $('#startScreen').classList.remove('hidden'); });
  </script>
</body>
</html>
